"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_cell=_interopRequireDefault(require("./cell")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_util=require("./util"),_utils=_interopRequireWildcard(require("../../tools/utils")),_dom=_interopRequireWildcard(require("../../tools/dom")),_formats=require("../../v-x-e-table/src/formats"),_log=require("../../tools/log"),_vn=require("../../tools/vn");function _getRequireWildcardCache(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(_getRequireWildcardCache=function(e){return e?r:t})(e))}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var r,i,n={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((i=l?Object.getOwnPropertyDescriptor(e,r):null)&&(i.get||i.set)?Object.defineProperty(n,r,i):n[r]=e[r]);return n.default=e,t&&t.set(e,n),n}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function ownKeys(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var setCellValue=_utils.default.setCellValue,hasChildrenList=_utils.default.hasChildrenList,getColumnList=_utils.default.getColumnList,calcHeight=_dom.default.calcHeight,hasClass=_dom.default.hasClass,addClass=_dom.default.addClass,removeClass=_dom.default.removeClass,getEventTargetNode=_dom.default.getEventTargetNode,isNodeElement=_dom.default.isNodeElement,isWebkit=_dom.browse["-webkit"]&&!_dom.browse.edge,debounceScrollYDuration=_dom.browse.msie?80:20,resizableStorageKey="VXE_TABLE_CUSTOM_COLUMN_WIDTH",visibleStorageKey="VXE_TABLE_CUSTOM_COLUMN_VISIBLE";function getRowUniqueId(){return _xeUtils.default.uniqueId("row_")}function eqCellValue(e,t,r){e=_xeUtils.default.get(e,r),t=_xeUtils.default.get(t,r);return!(!(0,_utils.eqEmptyValue)(e)||!(0,_utils.eqEmptyValue)(t))||(_xeUtils.default.isString(e)||_xeUtils.default.isNumber(e)?""+e==""+t:_xeUtils.default.isEqual(e,t))}function getNextSortOrder(e,t){e=e.sortOpts.orders,t=t.order||null,t=e.indexOf(t)+1;return e[t<e.length?t:0]}function getCustomStorageMap(e){var t=_conf.default.version,e=_xeUtils.default.toStringJSON(localStorage.getItem(e));return e&&e._v===t?e:{_v:t}}function getRecoverRow(e,t){var r=e.fullAllDataRowMap;return t.filter(function(e){return r.has(e)})}function handleReserveRow(e,t){var r=e.fullDataRowIdData,i=[];return _xeUtils.default.each(t,function(e,t){r[t]&&-1===i.indexOf(r[t].row)&&i.push(r[t].row)}),i}function computeVirtualX(e){var t=e.$refs,r=e.visibleColumn,e=t.tableBody,t=e?e.$el:null;if(t){for(var i=t.scrollLeft,n=i+t.clientWidth,l=-1,o=0,s=0,a=0,u=r.length;a<u&&(o+=r[a].renderWidth,!(0<=(l=-1===l&&i<o?a:l)&&(s++,n<o)));a++);return{toVisibleIndex:Math.max(0,l),visibleSize:Math.max(8,s)}}return{toVisibleIndex:0,visibleSize:8}}function computeVirtualY(e){var t,r,i=e.$refs,n=e.vSize,e=e.rowHeightMaps,l=i.tableHeader,i=i.tableBody,i=i?i.$el:null;return i?(l=l?l.$el:null,r=0,{rowHeight:r=(r=(t=!(t=i.querySelector("tr"))&&l?l.querySelector("tr"):t)?t.clientHeight:r)||e[n||"default"],visibleSize:Math.max(8,Math.ceil(i.clientHeight/r)+2)}):{rowHeight:0,visibleSize:8}}function calculateMergerOffserIndex(e,t,r){for(var i=0,n=e.length;i<n;i++){var l=e[i],o=t.startIndex,s=t.endIndex,a=l[r],l=a+l[r+"span"];a<o&&o<l&&(t.startIndex=a),a<s&&s<l&&(t.endIndex=l),t.startIndex===o&&t.endIndex===s||(i=-1)}}function setMerges(e,t,o,s){var r,a;t&&(r=e.treeConfig,a=e.visibleColumn,_xeUtils.default.isArray(t)||(t=[t]),r&&t.length&&(0,_log.errLog)("vxe.error.noTree",["merge-cells | merge-footer-items"]),t.forEach(function(e){var t,r,i=e.row,n=e.col,l=e.rowspan,e=e.colspan;s&&_xeUtils.default.isNumber(i)&&(i=s[i]),_xeUtils.default.isNumber(n)&&(n=a[n]),(s?i:_xeUtils.default.isNumber(i))&&n&&(l||e)&&(l=_xeUtils.default.toNumber(l)||1,e=_xeUtils.default.toNumber(e)||1,1<l||1<e)&&(t=_xeUtils.default.findIndexOf(o,function(e){return e._row===i&&e._col===n}),(t=o[t])?(t.rowspan=l,t.colspan=e,t._rowspan=l,t._colspan=e):(t=s?s.indexOf(i):i,r=a.indexOf(n),o.push({row:t,col:r,rowspan:l,colspan:e,_row:i,_col:n,_rowspan:l,_colspan:e})))}))}function removeMerges(e,t,i,n){var r,l,o=[];return t&&(r=e.treeConfig,l=e.visibleColumn,_xeUtils.default.isArray(t)||(t=[t]),r&&t.length&&(0,_log.errLog)("vxe.error.noTree",["merge-cells | merge-footer-items"]),t.forEach(function(e){var t=e.row,r=e.col,e=(n&&_xeUtils.default.isNumber(t)&&(t=n[t]),_xeUtils.default.isNumber(r)&&(r=l[r]),_xeUtils.default.findIndexOf(i,function(e){return e._row===t&&e._col===r}));-1<e&&(e=i.splice(e,1),o.push(e[0]))})),o}function clearAllSort(e){e.tableFullColumn.forEach(function(e){e.order=null})}function getOrderField(t,r){var i=r.sortBy,n=r.sortType;return function(e){e=i?_xeUtils.default.isFunction(i)?i({row:e,column:r}):_xeUtils.default.get(e,i):t.getCellLabel(e,r);return n&&"auto"!==n?"number"===n?_xeUtils.default.toNumber(e):"string"===n?_xeUtils.default.toValueString(e):e:isNaN(e)?e:_xeUtils.default.toNumber(e)}}var Methods={callSlot:function(e,t,r,i){if(e){var n=this.$xegrid;if(n)return n.callSlot(e,t,r,i);if(_xeUtils.default.isFunction(e))return(0,_vn.getSlotVNs)(e.call(this,t,r,i))}return[]},getParentElem:function(){var e=this.$el,t=this.$xegrid;return(t?t.$el:e).parentNode},getParentHeight:function(){var e=this.$el,t=this.$xegrid,r=this.height,e=e.parentNode,r="auto"===r?(0,_dom.getPaddingTopBottomSize)(e):0;return Math.floor(t?t.getParentHeight():_xeUtils.default.toNumber(getComputedStyle(e).height)-r)},getExcludeHeight:function(){var e=this.$xegrid;return e?e.getExcludeHeight():0},clearAll:function(){return(0,_util.clearTableAllStatus)(this)},syncData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadTableData(e.tableFullData)})})},updateData:function(){var e=this,t=this.scrollXLoad,r=this.scrollYLoad;return this.handleTableData(!0).then(function(){if(e.updateFooter(),e.checkSelectionStatus(),t||r)return t&&e.updateScrollXSpace(),r&&e.updateScrollYSpace(),e.refreshScroll()}).then(function(){return e.updateCellAreas(),e.recalculate(!0)}).then(function(){setTimeout(function(){return e.recalculate()},50)})},handleTableData:function(e){var r=this,t=this.scrollYLoad,i=this.scrollYStore,n=this.fullDataRowIdData,l=this.afterFullData,e=(e&&(this.updateAfterFullData(),l=this.handleVirtualTreeToList()),t?l.slice(i.startIndex,i.endIndex):l.slice(0));return e.forEach(function(e,t){e=(0,_util.getRowid)(r,e),e=n[e];e&&(e.$index=t)}),this.tableData=e,this.$nextTick()},updateScrollYStatus:function(e){var t=this.treeConfig,r=this.treeOpts,i=this.sYOpts,r=(r.transform||!t)&&!!i.enabled&&-1<i.gt&&(0===i.gt||i.gt<=e.length);return this.scrollYLoad=r},loadTableData:function(e){var i=this,t=this.keepSource,r=this.treeConfig,n=this.treeOpts,l=this.editStore,o=this.scrollYStore,s=this.scrollXStore,a=this.lastScrollLeft,u=this.lastScrollTop,c=this.scrollYLoad,h=this.sXOpts,d=this.sYOpts,f=[],g=e?e.slice(0):[],p=(r&&(n.transform?("development"===process.env.NODE_ENV&&(n.rowField||(0,_log.errLog)("vxe.error.reqProp",["table.tree-config.rowField"]),n.parentField||(0,_log.errLog)("vxe.error.reqProp",["table.tree-config.parentField"]),n.children||(0,_log.errLog)("vxe.error.reqProp",["tree-config.children"]),n.mapChildren||(0,_log.errLog)("vxe.error.reqProp",["tree-config.mapChildren"]),n.children===n.mapChildren&&(0,_log.errLog)("vxe.error.errConflicts",["tree-config.children","tree-config.mapChildren"]),g.forEach(function(e){e[n.children]&&e[n.children].length&&(0,_log.warnLog)("vxe.error.errConflicts",["tree-config.transform","row.".concat(n.children)])})),g=(f=_xeUtils.default.toArrayTree(g,{key:n.rowField,parentKey:n.parentField,children:n.children,mapChildren:n.mapChildren})).slice(0)):f=g.slice(0)),o.startIndex=0,o.endIndex=1,s.startIndex=0,s.endIndex=1,l.insertList=[],l.removeList=[],this.updateScrollYStatus(g));return this.scrollYLoad=p,this.tableFullData=g,this.tableFullTreeData=f,this.cacheRowMap(!0),this.tableSynchData=e,t&&(this.tableSourceData=_xeUtils.default.clone(g,!0)),"development"===process.env.NODE_ENV&&p&&(this.height||this.maxHeight||(0,_log.errLog)("vxe.error.reqProp",["table.height | table.max-height | table.scroll-y={enabled: false}"]),this.showOverflow||(0,_log.warnLog)("vxe.error.reqProp",["table.show-overflow"]),this.spanMethod)&&(0,_log.warnLog)("vxe.error.scrollErrProp",["table.span-method"]),this.clearCellAreas&&this.mouseConfig&&(this.clearCellAreas(),this.clearCopyCellArea()),this.clearMergeCells(),this.clearMergeFooterItems(),this.handleTableData(!0),this.updateFooter(),this.$nextTick().then(function(){i.updateHeight(),i.updateStyle()}).then(function(){i.computeScrollLoad()}).then(function(){return p&&(o.endIndex=o.visibleSize),i.handleReserveStatus(),i.checkSelectionStatus(),new Promise(function(r){i.$nextTick().then(function(){return i.recalculate()}).then(function(){var e=a,t=u;h.scrollToLeftOnChange&&(e=0),d.scrollToTopOnChange&&(t=0),c===p?(0,_util.restoreScrollLocation)(i,e,t).then(r):setTimeout(function(){return(0,_util.restoreScrollLocation)(i,e,t).then(r)})})})})},loadData:function(e){var t=this,r=this.inited,i=this.initStatus;return this.loadTableData(e).then(function(){return t.inited=!0,t.initStatus=!0,i||t.handleLoadDefaults(),r||t.handleInitDefaults(),t.recalculate()})},reloadData:function(e){var t=this,r=this.inited;return this.clearAll().then(function(){return t.inited=!0,t.initStatus=!0,t.loadTableData(e)}).then(function(){return t.handleLoadDefaults(),r||t.handleInitDefaults(),t.recalculate()})},reloadRow:function(e,t,r){var i=this.keepSource,n=this.tableSourceData,l=this.tableData;return i?((i=n[this.getRowIndex(e)])&&e&&(r?(n=_xeUtils.default.get(t||e,r),_xeUtils.default.set(e,r,n),_xeUtils.default.set(i,r,n)):(r=_xeUtils.default.clone(_objectSpread({},t),!0),_xeUtils.default.destructuring(i,Object.assign(e,r)))),this.tableData=l.slice(0)):"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.reqProp",["keep-source"]),this.$nextTick()},loadColumn:function(e){var t=this,e=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)},{children:"children"});return this.handleColumn(e)},reloadColumn:function(e){var t=this;return this.clearAll().then(function(){return t.loadColumn(e)})},handleColumn:function(e){var t=this,r=(this.collectColumn=e,getColumnList(e));return this.tableFullColumn=r,this.cacheColumnMap(),this.restoreCustomStorage(),this.parseColumns().then(function(){t.scrollXLoad&&t.loadScrollXData(!0)}),this.clearMergeCells(),this.clearMergeFooterItems(),this.handleTableData(!0),"development"===process.env.NODE_ENV&&(this.scrollXLoad||this.scrollYLoad)&&this.expandColumn&&(0,_log.warnLog)("vxe.error.scrollErrProp",["column.type=expand"]),this.$nextTick().then(function(){return t.$toolbar&&t.$toolbar.syncUpdate({collectColumn:e,$table:t}),t.recalculate()})},cacheRowMap:function(s){function e(e,t,r,i,n,l){var o=(0,_util.getRowid)(a,e),i=u&&i?(0,_util.toTreePathSeq)(i):t+1,l=l?l.length-1:0,i=((0,_utils.eqEmptyValue)(o)&&(o=getRowUniqueId(),_xeUtils.default.set(e,p,o)),x&&e[c.hasChild]&&_xeUtils.default.isUndefined(e[c.children])&&(e[c.children]=null),{row:e,rowid:o,seq:i,index:u&&n?-1:t,_index:-1,$index:-1,items:r,parent:n,level:l});s&&(f[o]=i,h.set(e,i)),g[o]=i,d.set(e,i)}var a=this,u=this.treeConfig,c=this.treeOpts,t=this.tableFullData,h=this.fullDataRowMap,d=this.fullAllDataRowMap,r=this.tableFullTreeData,f=this.fullDataRowIdData,g=this.fullAllDataRowIdData,p=(0,_util.getRowkey)(this),x=u&&c.lazy;s&&(f=this.fullDataRowIdData={},h.clear()),g=this.fullAllDataRowIdData={},d.clear(),u?_xeUtils.default.eachTree(r,e,c):t.forEach(e)},loadTreeChildren:function(i,e){var s=this,n=this.keepSource,l=this.tableSourceData,o=this.treeOpts,a=this.fullDataRowIdData,u=this.fullDataRowMap,c=this.fullAllDataRowMap,h=this.fullAllDataRowIdData,d=o.transform,f=o.children,g=o.mapChildren,t=h[(0,_util.getRowid)(this,i)],p=t?t.level:0;return this.createData(e).then(function(e){var t,r;return n&&(t=(0,_util.getRowid)(s,i),r=_xeUtils.default.findTree(l,function(e){return t===(0,_util.getRowid)(s,e)},o))&&(r.item[f]=_xeUtils.default.clone(e,!0)),_xeUtils.default.eachTree(e,function(e,t,r,i,n,l){var o=(0,_util.getRowid)(s,e),t={row:e,rowid:o,seq:-1,index:t,_index:-1,$index:-1,items:r,parent:n,level:p+l.length};a[o]=t,u.set(e,t),h[o]=t,c.set(e,t)},o),i[f]=e,d&&(i[g]=e),s.updateAfterDataIndex(),e})},cacheColumnMap:function(){function o(e,t,r,i,n){var l=e.id,o=e.field,s=e.fixed,a=e.type,u=e.treeNode,t={column:e,colid:l,index:t,items:r,parent:n};o&&("development"===process.env.NODE_ENV&&m[o]&&(0,_log.warnLog)("vxe.error.colRepet",["field",o]),m[o]=t),!g&&s&&(g=s),u?("development"===process.env.NODE_ENV&&h&&(0,_log.warnLog)("vxe.error.colRepet",["tree-node",u]),h=h||e):"expand"===a&&("development"===process.env.NODE_ENV&&c&&(0,_log.warnLog)("vxe.error.colRepet",["type",a]),c=c||e),"development"===process.env.NODE_ENV&&("checkbox"===a?(d&&(0,_log.warnLog)("vxe.error.colRepet",["type",a]),d=d||e):"radio"===a&&(f&&(0,_log.warnLog)("vxe.error.colRepet",["type",a]),f=f||e)),"development"===process.env.NODE_ENV&&(p.showOverflow&&!1===e.showOverflow&&(0,_log.warnLog)("vxe.error.errConflicts",["table.show-overflow=".concat(p.showOverflow),"column.show-overflow=".concat(e.showOverflow)]),p.showHeaderOverflow&&!1===e.showHeaderOverflow&&(0,_log.warnLog)("vxe.error.errConflicts",["table.show-header-overflow=".concat(p.showHeaderOverflow),"column.show-header-overflow=".concat(e.showHeaderOverflow)]),p.showFooterOverflow)&&!1===e.showFooterOverflow&&(0,_log.warnLog)("vxe.error.errConflicts",["table.show-footer-overflow=".concat(p.showFooterOverflow),"column.show-footer-overflow=".concat(e.showFooterOverflow)]),w&&!1===e.showOverflow&&(w=!1),v[l]&&(0,_log.errLog)("vxe.error.colRepet",["colId",l]),v[l]=t,x.set(e,t)}var c,h,d,f,g,p=this,e=this.tableFullColumn,t=this.collectColumn,x=this.fullColumnMap,r=this.showOverflow,v=this.fullColumnIdData={},m=this.fullColumnFieldData={},i=t.some(hasChildrenList),w=!!r;x.clear(),i?_xeUtils.default.eachTree(t,function(e,t,r,i,n,l){e.level=l.length,o(e,t,r,0,n)}):e.forEach(o),"development"===process.env.NODE_ENV&&c&&this.mouseOpts.area&&(0,_log.errLog)("vxe.error.errConflicts",["mouse-config.area","column.type=expand"]),this.isGroup=i,this.treeNodeColumn=h,this.expandColumn=c,this.isAllOverflow=w},getRowNode:function(e){if(e){e=this.fullAllDataRowIdData[e.getAttribute("rowid")];if(e)return{rowid:e.rowid,item:e.row,index:e.index,items:e.items,parent:e.parent}}return null},getColumnNode:function(e){if(e){e=this.fullColumnIdData[e.getAttribute("colid")];if(e)return{colid:e.colid,item:e.column,index:e.index,items:e.items,parent:e.parent}}return null},getRowSeq:function(e){var t=this.fullDataRowIdData;if(e){t=t[(0,_util.getRowid)(this,e)];if(t)return t.seq}return-1},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},getVTRowIndex:function(e){return this.afterFullData.indexOf(e)},_getRowIndex:function(e){return"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delFunc",["_getRowIndex","getVTRowIndex"]),this.getVTRowIndex(e)},getVMRowIndex:function(e){return this.tableData.indexOf(e)},$getRowIndex:function(e){return"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delFunc",["$getRowIndex","getVMRowIndex"]),this.getVMRowIndex(e)},getColumnIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},getVTColumnIndex:function(e){return this.visibleColumn.indexOf(e)},_getColumnIndex:function(e){return"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delFunc",["_getColumnIndex","getVTColumnIndex"]),this.getVTColumnIndex(e)},getVMColumnIndex:function(e){return this.tableColumn.indexOf(e)},$getColumnIndex:function(e){return"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delFunc",["$getColumnIndex","getVMColumnIndex"]),this.getVMColumnIndex(e)},isSeqColumn:function(e){return e&&"seq"===e.type},defineField:function(n){var e=this.radioOpts,t=this.checkboxOpts,r=this.treeConfig,i=this.treeOpts,l=this.expandOpts,o=(0,_util.getRowkey)(this);return this.tableFullColumn.forEach(function(e){var t,r=e.field,i=e.editRender;r&&!_xeUtils.default.has(n,r)&&(t=null,i&&(i=i.defaultValue,_xeUtils.default.isFunction(i)?t=i({column:e}):_xeUtils.default.isUndefined(i)||(t=i)),_xeUtils.default.set(n,r,t))}),[e.labelField,t.checkField,t.labelField,l.labelField].forEach(function(e){e&&(0,_utils.eqEmptyValue)(_xeUtils.default.get(n,e))&&_xeUtils.default.set(n,e,null)}),r&&i.lazy&&_xeUtils.default.isUndefined(n[i.children])&&(n[i.children]=null),(0,_utils.eqEmptyValue)(_xeUtils.default.get(n,o))&&_xeUtils.default.set(n,o,getRowUniqueId()),n},createData:function(e){function t(e){return r.defineField(Object.assign({},e))}var r=this,i=this.treeConfig,n=this.treeOpts,l=i?_xeUtils.default.mapTree(e,t,n):e.map(t);return this.$nextTick().then(function(){return l})},createRow:function(e){var t=this,r=_xeUtils.default.isArray(e);return r||(e=[e]),this.$nextTick().then(function(){return t.createData(e).then(function(e){return r?e:e[0]})})},revertData:function(e,r){var i=this,t=this.keepSource,n=this.tableSourceData,l=this.treeConfig;return t?((t=e)?_xeUtils.default.isArray(e)||(t=[e]):t=_xeUtils.default.toArray(this.getUpdateRecords()),t.length&&t.forEach(function(e){var t;i.isInsertByRow(e)||(t=i.getRowIndex(e),l&&-1===t&&(0,_log.errLog)("vxe.error.noTree",["revertData"]),(t=n[t])&&e&&(r?_xeUtils.default.set(e,r,_xeUtils.default.clone(_xeUtils.default.get(t,r),!0)):_xeUtils.default.destructuring(e,_xeUtils.default.clone(t,!0))))}),e?this.$nextTick():this.reloadData(n)):("development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.reqProp",["keep-source"]),this.$nextTick())},clearData:function(e,t){var r=this.tableFullData,i=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=r,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){i.forEach(function(e){e.field&&setCellValue(t,e,null)})}),this.$nextTick()},isInsertByRow:function(e){return-1<this.editStore.insertList.indexOf(e)},removeInsertRow:function(){return this.remove(this.editStore.insertList)},isUpdateByRow:function(e,t){var r=this,i=this.visibleColumn,n=this.keepSource,l=this.treeConfig,o=this.treeOpts,s=this.tableSourceData,a=this.fullDataRowIdData;if(n){var u,c,h=(0,_util.getRowid)(this,e);if(!a[h])return!1;if(l?(n=o.children,l=_xeUtils.default.findTree(s,function(e){return h===(0,_util.getRowid)(r,e)},o),e=Object.assign({},e,_defineProperty({},n,null)),l&&(c=Object.assign({},l.item,_defineProperty({},n,null)))):c=s[a[h].index],c){if(1<arguments.length)return!eqCellValue(c,e,t);for(var d=0,f=i.length;d<f;d++)if((u=i[d].field)&&!eqCellValue(c,e,u))return!0}}return!1},getColumns:function(e){var t=this.visibleColumn;return _xeUtils.default.isUndefined(e)?t.slice(0):t[e]},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(e){var t=this.fullColumnFieldData;return t[e]?t[e].column:null},getTableColumn:function(){return{collectColumn:this.collectColumn.slice(0),fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getData:function(e){var t=this.data||this.tableSynchData;return _xeUtils.default.isUndefined(e)?t.slice(0):t[e]},getCheckboxRecords:function(e){var t,r=this,i=this.tableFullData,n=this.afterFullData,l=this.treeConfig,o=this.treeOpts,s=this.checkboxOpts,a=this.tableFullTreeData,u=this.afterTreeFullData,c=o.transform,h=o.children,o=o.mapChildren,d=s.checkField,s=e?c?a:i:c?u:n;return d?l?_xeUtils.default.filterTree(s,function(e){return _xeUtils.default.get(e,d)},{children:c?o:h}):s.filter(function(e){return _xeUtils.default.get(e,d)}):(t=this.selection,l?_xeUtils.default.filterTree(s,function(e){return-1<r.findRowIndexOf(t,e)},{children:c?o:h}):s.filter(function(e){return-1<r.findRowIndexOf(t,e)}))},handleVirtualTreeToList:function(){var l,o,e=this.treeOpts,t=this.treeConfig,s=this.treeExpandeds,r=this.afterTreeFullData,i=this.afterFullData;return t&&e.transform?(l=[],o=new Map,_xeUtils.default.eachTree(r,function(e,t,r,i,n){(!n||o.has(n)&&-1<s.indexOf(n))&&(o.set(e,1),l.push(e))},{children:e.mapChildren}),this.afterFullData=l,this.updateScrollYStatus(l),l):i},updateAfterFullData:function(){var e,c=this,t=this.tableFullColumn,r=this.tableFullData,i=this.filterOpts,n=this.sortOpts,l=this.treeConfig,o=this.treeOpts,s=this.tableFullTreeData,h=i.remote,d=i.filterMethod,a=n.remote,i=n.sortMethod,u=n.multiple,n=n.chronological,f=o.transform,g=[],p=[],x=[],v=[],m=(t.forEach(function(e){var t,r,i=e.field,n=e.sortable,l=e.order,o=e.filters;!h&&o&&o.length&&(t=[],r=[],o.forEach(function(e){e.checked&&(r.push(e),t.push(e.value))}),r.length)&&x.push({column:e,valueList:t,itemList:r}),!a&&n&&l&&v.push({column:e,field:i,property:i,order:l,sortTime:e.sortTime})}),u&&n&&1<v.length&&(v=_xeUtils.default.orderBy(v,"sortTime")),x.length?(t=function(u){return x.every(function(e){var t,r,i,n,l,o,s=e.column,a=e.valueList,e=e.itemList;return!(a.length&&!h)||(t=s.filterMethod,i=s.filterRender,r=s.field,i=i?_vXETable.default.renderer.get(i.name):null,n=i&&i.renderFilter?i.filterMethod:null,l=i?i.defaultFilterMethod:null,o=_utils.default.getCellValue(u,s),t?e.some(function(e){return t({value:e.value,option:e,cellValue:o,row:u,column:s,$table:c})}):n?e.some(function(e){return n({value:e.value,option:e,cellValue:o,row:u,column:s,$table:c})}):d?d({options:e,values:a,cellValue:o,row:u,column:s}):l?e.some(function(e){return l({value:e.value,option:e,cellValue:o,row:u,column:s,$table:c})}):-1<a.indexOf(_xeUtils.default.get(u,r)))})},l&&f?g=p=_xeUtils.default.searchTree(s,t,_objectSpread(_objectSpread({},o),{},{original:!0})):p=g=(l?s:r).filter(t)):l&&f?g=p=_xeUtils.default.searchTree(s,function(){return!0},_objectSpread(_objectSpread({},o),{},{original:!0})):p=g=(l?s:r).slice(0),v[0]);!a&&m&&(l&&f?g=p=i?(n=i({data:p,sortList:v,$table:this}),_xeUtils.default.isArray(n)?n:p):_xeUtils.default.orderBy(p,v.map(function(e){var t=e.column,e=e.order;return[getOrderField(c,t),e]})):p=g=i?(t=i({data:g,column:m.column,property:m.field,field:m.field,order:m.order,sortList:v,$table:this}),_xeUtils.default.isArray(t)?t:g):u?_xeUtils.default.orderBy(g,v.map(function(e){var t=e.column,e=e.order;return[getOrderField(c,t),e]})):(_xeUtils.default.isArray(m.sortBy)&&(e=m.sortBy.map(function(e){return[e,m.order]})),_xeUtils.default.orderBy(g,e||[m].map(function(e){var t=e.column,e=e.order;return[getOrderField(c,t),e]})))),this.afterFullData=g,this.afterTreeFullData=p,this.updateAfterDataIndex()},updateAfterDataIndex:function(){var o=this,e=this.treeConfig,t=this.afterFullData,s=this.fullDataRowIdData,a=this.fullAllDataRowIdData,r=this.afterTreeFullData,i=this.treeOpts;e?_xeUtils.default.eachTree(r,function(e,t,r,i){var n=(0,_util.getRowid)(o,e),l=a[n],i=i.map(function(e,t){return t%2==0?Number(e)+1:"."}).join("");l?(l.seq=i,l._index=t):(a[n]=l={row:e,rowid:n,seq:i,index:-1,$index:-1,_index:t,items:[],parent:null,level:0},s[n]=l)},{children:i.transform?i.mapChildren:i.children}):t.forEach(function(e,t){var r=(0,_util.getRowid)(o,e),i=a[r],n=t+1;i?(i.seq=n,i._index=t):(a[r]=i={row:e,rowid:r,seq:n,index:-1,$index:-1,_index:t,items:[],parent:null,level:0},s[r]=i)})},getParentRow:function(e){var t=this.treeConfig,r=this.fullDataRowIdData;if(e&&t){t=_xeUtils.default.isString(e)?e:(0,_util.getRowid)(this,e);if(t)return r[t]?r[t].parent:null}return null},getRowById:function(e){var t=this.fullDataRowIdData,e=_xeUtils.default.eqNull(e)?"":encodeURIComponent(e);return t[e]?t[e].row:null},getRowid:function(e){var t=this.fullAllDataRowMap;return t.has(e)?t.get(e).rowid:null},getTableData:function(){var e=this.tableFullData,t=this.afterFullData,r=this.tableData,i=this.footerTableData;return{fullData:e.slice(0),visibleData:t.slice(0),tableData:r.slice(0),footerData:i.slice(0)}},handleLoadDefaults:function(){var e=this;this.checkboxConfig&&this.handleDefaultSelectionChecked(),this.radioConfig&&this.handleDefaultRadioChecked(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.mergeCells&&this.handleDefaultMergeCells(),this.mergeFooterItems&&this.handleDefaultMergeFooterItems(),this.$nextTick(function(){return setTimeout(e.recalculate)})},handleInitDefaults:function(){this.sortConfig&&this.handleDefaultSort()},hideColumn:function(e){e=(0,_util.handleFieldOrColumn)(this,e);return e&&(e.visible=!1),this.handleCustom()},showColumn:function(e){e=(0,_util.handleFieldOrColumn)(this,e);return e&&(e.visible=!0),this.handleCustom()},setColumnWidth:function(e,t){var r,i,e=(0,_util.handleFieldOrColumn)(this,e);return e&&(i=r=_xeUtils.default.toInteger(t),_dom.default.isScale(t)&&(t=(t=(t=this.$refs.tableBody)?t.$el:null)?t.clientWidth-1:0,i=Math.floor(r*t)),e.renderWidth=i),this.$nextTick()},getColumnWidth:function(e){e=(0,_util.handleFieldOrColumn)(this,e);return e?e.renderWidth:0},resetColumn:function(e){var t=this.customOpts.checkMethod,r=Object.assign({visible:!0,resizable:!0===e},e);return this.tableFullColumn.forEach(function(e){r.resizable&&(e.resizeWidth=0),t&&!t({column:e})||(e.visible=e.defaultVisible)}),r.resizable&&this.saveCustomResizable(!0),this.handleCustom()},handleCustom:function(){return this.saveCustomVisible(),this.analyColumnWidth(),this.refreshColumn()},restoreCustomStorage:function(){var r,i,e=this.id,t=this.collectColumn,n=this.customConfig,l=this.customOpts,o=l.storage,l=!0===l.storage,s=l||o&&o.resizable,l=l||o&&o.visible;n&&(s||l)&&(r={},e?(s&&(o=getCustomStorageMap(resizableStorageKey)[e])&&_xeUtils.default.each(o,function(e,t){r[t]={field:t,resizeWidth:e}}),l&&(n=getCustomStorageMap(visibleStorageKey)[e])&&(o=(s=n.split("|"))[0]?s[0].split(","):[],l=s[1]?s[1].split(","):[],o.forEach(function(e){r[e]?r[e].visible=!1:r[e]={field:e,visible:!1}}),l.forEach(function(e){r[e]?r[e].visible=!0:r[e]={field:e,visible:!0}})),i={},_xeUtils.default.eachTree(t,function(e){var t=e.getKey();t&&(i[t]=e)}),_xeUtils.default.each(r,function(e,t){var r=e.visible,e=e.resizeWidth,t=i[t];t&&(_xeUtils.default.isNumber(e)&&(t.resizeWidth=e),_xeUtils.default.isBoolean(r))&&(t.visible=r)})):(0,_log.errLog)("vxe.error.reqProp",["id"]))},saveCustomVisible:function(){var r,i,e=this.id,t=this.collectColumn,n=this.customConfig,l=this.customOpts,o=l.checkMethod,s=l.storage,l=!0===l.storage||s&&s.visible;n&&l&&(s=getCustomStorageMap(visibleStorageKey),r=[],i=[],e?(_xeUtils.default.eachTree(t,function(e){var t;o&&!o({column:e})||(!e.visible&&e.defaultVisible?(t=e.getKey())&&r.push(t):e.visible&&!e.defaultVisible&&(t=e.getKey())&&i.push(t))}),s[e]=[r.join(",")].concat(i.length?[i.join(",")]:[]).join("|")||void 0,localStorage.setItem(visibleStorageKey,_xeUtils.default.toJSONString(s))):(0,_log.errLog)("vxe.error.reqProp",["id"]))},saveCustomResizable:function(e){var r,t=this.id,i=this.collectColumn,n=this.customConfig,l=this.customOpts,o=l.storage,l=!0===l.storage||o&&o.resizable;n&&l&&(o=getCustomStorageMap(resizableStorageKey),t?(e||(r=_xeUtils.default.isPlainObject(o[t])?o[t]:{},_xeUtils.default.eachTree(i,function(e){var t;e.resizeWidth&&(t=e.getKey())&&(r[t]=e.renderWidth)})),o[t]=_xeUtils.default.isEmpty(r)?void 0:r,localStorage.setItem(resizableStorageKey,_xeUtils.default.toJSONString(o))):(0,_log.errLog)("vxe.error.reqProp",["id"]))},refreshColumn:function(){var e=this;return this.parseColumns().then(function(){return e.refreshScroll()}).then(function(){return e.recalculate()})},parseColumns:function(){var t,r,i,e=this,o=[],s=[],a=[],n=this.collectColumn,l=this.tableFullColumn,u=this.isGroup,c=this.columnStore,h=this.sXOpts,d=this.scrollXStore,f=(u?(t=[],r=[],i=[],_xeUtils.default.eachTree(n,function(e,t,r,i,n){var l=hasChildrenList(e);n&&n.fixed&&(e.fixed=n.fixed),n&&e.fixed!==n.fixed&&(0,_log.errLog)("vxe.error.groupFixed"),l?e.visible=!!_xeUtils.default.findTree(e.children,function(e){return hasChildrenList(e)?null:e.visible}):e.visible&&("left"===e.fixed?o:"right"===e.fixed?a:s).push(e)}),n.forEach(function(e){e.visible&&("left"===e.fixed?t:"right"===e.fixed?i:r).push(e)}),this.tableGroupColumn=t.concat(r).concat(i)):l.forEach(function(e){e.visible&&("left"===e.fixed?o:"right"===e.fixed?a:s).push(e)}),o.concat(s).concat(a)),u=h.enabled&&-1<h.gt&&(0===h.gt||h.gt<=l.length);return this.hasFixedColumn=0<o.length||0<a.length,Object.assign(c,{leftList:o,centerList:s,rightList:a}),u&&("development"===process.env.NODE_ENV&&(this.showHeader&&!this.showHeaderOverflow&&(0,_log.warnLog)("vxe.error.reqProp",["show-header-overflow"]),this.showFooter&&!this.showFooterOverflow&&(0,_log.warnLog)("vxe.error.reqProp",["show-footer-overflow"]),this.spanMethod&&(0,_log.warnLog)("vxe.error.scrollErrProp",["span-method"]),this.footerSpanMethod)&&(0,_log.warnLog)("vxe.error.scrollErrProp",["footer-span-method"]),n=computeVirtualX(this).visibleSize,d.startIndex=0,d.endIndex=n,d.visibleSize=n),f.length===this.visibleColumn.length&&this.visibleColumn.every(function(e,t){return e===f[t]})||(this.clearMergeCells(),this.clearMergeFooterItems()),this.scrollXLoad=u,this.visibleColumn=f,this.handleTableColumn(),this.updateFooter().then(function(){return e.recalculate()}).then(function(){return e.updateCellAreas(),e.recalculate()})},analyColumnWidth:function(){var e=this.columnOpts,t=e.width,r=e.minWidth,i=[],n=[],l=[],o=[],s=[],a=[];this.tableFullColumn.forEach(function(e){t&&!e.width&&(e.width=t),r&&!e.minWidth&&(e.minWidth=r),e.visible&&(e.resizeWidth?i:_dom.default.isPx(e.width)?n:_dom.default.isScale(e.width)?o:_dom.default.isPx(e.minWidth)?l:_dom.default.isScale(e.minWidth)?s:a).push(e)}),Object.assign(this.columnStore,{resizeList:i,pxList:n,pxMinList:l,scaleList:o,scaleMinList:s,autoList:a})},refreshScroll:function(){var t=this,r=this.lastScrollLeft,i=this.lastScrollTop,e=this.$refs,n=e.tableBody,l=e.leftBody,o=e.rightBody,e=e.tableFooter,s=n?n.$el:null,a=l?l.$el:null,u=o?o.$el:null,c=e?e.$el:null;return new Promise(function(e){if(r||i)return(0,_util.restoreScrollLocation)(t,r,i).then(function(){setTimeout(e,30)});(0,_dom.setScrollTop)(s,i),(0,_dom.setScrollTop)(a,i),(0,_dom.setScrollTop)(u,i),(0,_dom.setScrollLeft)(c,r),setTimeout(e,30)})},recalculate:function(e){var t=this,r=this.$refs,i=r.tableBody,n=r.tableHeader,r=r.tableFooter,l=i?i.$el:null,o=n?n.$el:null,s=r?r.$el:null;return l&&(this.autoCellWidth(o,l,s),!0===e)?this.computeScrollLoad().then(function(){return t.autoCellWidth(o,l,s),t.computeScrollLoad()}):this.computeScrollLoad()},autoCellWidth:function(e,t,r){var i=0,n=t.clientWidth-1,l=n,o=l/100,s=this.fit,a=this.columnStore,u=a.resizeList,c=a.pxMinList,h=a.pxList,d=a.scaleList,f=a.scaleMinList,a=a.autoList;if(c.forEach(function(e){var t=parseInt(e.minWidth);i+=t,e.renderWidth=t}),f.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*o);i+=t,e.renderWidth=t}),d.forEach(function(e){var t=Math.floor(parseInt(e.width)*o);i+=t,e.renderWidth=t}),h.forEach(function(e){var t=parseInt(e.width);i+=t,e.renderWidth=t}),u.forEach(function(e){var t=parseInt(e.resizeWidth);i+=t,e.renderWidth=t}),o=0<(l-=i)?Math.floor(l/(f.length+c.length+a.length)):0,s?0<l&&f.concat(c).forEach(function(e){i+=o,e.renderWidth+=o}):o=40,a.forEach(function(e){var t=Math.max(o,40);e.renderWidth=t,i+=t}),s){var g=d.concat(f).concat(c).concat(a),p=g.length-1;if(0<p){var x=n-i;if(0<x){for(;0<x&&0<=p;)x--,g[p--].renderWidth++;i=n}}}h=t.offsetHeight,u=t.scrollHeight>t.clientHeight;this.scrollbarWidth=u?t.offsetWidth-t.clientWidth:0,this.overflowY=u,this.tableWidth=i,this.tableHeight=h,e?(this.headerHeight=e.clientHeight,this.$nextTick(function(){e&&t&&e.scrollLeft!==t.scrollLeft&&(e.scrollLeft=t.scrollLeft)})):this.headerHeight=0,r?(l=r.offsetHeight,this.scrollbarHeight=Math.max(l-r.clientHeight,0),this.overflowX=i>r.clientWidth,this.footerHeight=l):(this.footerHeight=0,this.scrollbarHeight=Math.max(h-t.clientHeight,0),this.overflowX=n<i),this.updateHeight(),this.parentHeight=Math.max(this.headerHeight+this.footerHeight+20,this.getParentHeight()),this.overflowX&&this.checkScrolling()},updateHeight:function(){this.customHeight=calcHeight(this,"height"),this.customMaxHeight=calcHeight(this,"maxHeight")},updateStyle:function(){var c=this,t=this.$refs,h=this.isGroup,d=this.fullColumnIdData,f=this.tableColumn,g=this.customHeight,p=this.customMaxHeight,x=this.border,v=this.headerHeight,m=this.showFooter,w=this.showOverflow,b=this.showHeaderOverflow,C=this.showFooterOverflow,_=this.footerHeight,R=this.tableHeight,E=this.tableWidth,y=this.scrollbarHeight,T=this.scrollbarWidth,S=this.scrollXLoad,O=this.scrollYLoad,k=this.cellOffsetWidth,I=this.columnStore,D=this.elemStore,e=this.editStore,r=this.currentRow,i=this.mouseConfig,U=this.keyboardConfig,L=this.keyboardOpts,$=this.spanMethod,M=this.mergeList,A=this.mergeFooterList,F=this.footerSpanMethod,N=this.isAllOverflow,V=this.visibleColumn,n=t.emptyPlaceholder,l=D["main-body-wrapper"];return n&&(n.style.top="".concat(v,"px"),n.style.height=l?"".concat(l.offsetHeight-y,"px"):""),0<g&&m&&(g+=y),["main","left","right"].forEach(function(a,e){var o=0<e?a:"",s=I["".concat(o,"List")],u=t["".concat(o,"Container")];["header","body","footer"].forEach(function(n){var e,t,r=D["".concat(a,"-").concat(n,"-wrapper")],i=D["".concat(a,"-").concat(n,"-table")],l=("header"===n?(t=E,e=f,h?e=V:o&&(S||b)&&(e=s),t=e.reduce(function(e,t){return e+t.renderWidth},0),i&&(i.style.width=t?"".concat(t+T,"px"):"",_dom.browse.msie)&&_xeUtils.default.arrayEach(i.querySelectorAll(".vxe-resizable"),function(e){e.style.height="".concat(e.parentNode.offsetHeight,"px")}),(e=D["".concat(a,"-").concat(n,"-repair")])&&(e.style.width="".concat(E,"px")),t=D["".concat(a,"-").concat(n,"-list")],h&&t&&_xeUtils.default.arrayEach(t.querySelectorAll(".col--group"),function(e){var t,r,i,n=c.getColumnNode(e);n&&(n=(t=n.item).showHeaderOverflow,n=_xeUtils.default.isBoolean(n)?n:b,i=r=0,(n="title"===n||(!0===n||"tooltip"===n)||"ellipsis"===n)&&_xeUtils.default.eachTree(t.children,function(e){e.children&&t.children.length||i++,r+=e.renderWidth}),e.style.width=n?"".concat(r-i-(x?2:0),"px"):"")})):"body"===n?(e=D["".concat(a,"-").concat(n,"-emptyBlock")],isNodeElement(r)&&(p?r.style.maxHeight="".concat(o?p-v-(m?0:y):p-v,"px"):r.style.height=0<g?"".concat(o?(0<g?g-v-_:R)-(m?0:y):g-v-_,"px"):""),u&&(t="right"===o,l=I["".concat(o,"List")],isNodeElement(r)&&(r.style.top="".concat(v,"px")),u.style.height="".concat((0<g?g-v-_:R)+v+_-y*(m?2:1),"px"),u.style.width="".concat(l.reduce(function(e,t){return e+t.renderWidth},t?T:0),"px")),l=E,t=f,l=(t=o?!(S||O||w&&N)||M.length||$||U&&L.isMerge?V:s:t).reduce(function(e,t){return e+t.renderWidth},0),i&&(i.style.width=l?"".concat(l,"px"):"",i.style.paddingRight=T&&o&&(_dom.browse["-moz"]||_dom.browse.safari)?"".concat(T,"px"):""),e&&(e.style.width=l?"".concat(l,"px"):"")):"footer"===n&&(t=E,e=f,t=(e=o?!S&&!C||A.length&&F?V:s:e).reduce(function(e,t){return e+t.renderWidth},0),isNodeElement(r)&&(u&&(r.style.top="".concat(0<g?g-_:R+v,"px")),r.style.marginTop="".concat(-y,"px")),i)&&(i.style.width=t?"".concat(t+T,"px"):""),D["".concat(a,"-").concat(n,"-colgroup")]);l&&_xeUtils.default.arrayEach(l.children,function(e){var o,t,s,r,i=e.getAttribute("name");"col_gutter"===i&&(e.style.width="".concat(T,"px")),d[i]&&(i=(o=d[i].column).showHeaderOverflow,r=o.showFooterOverflow,t=o.showOverflow,e.style.width="".concat(o.renderWidth,"px"),i="ellipsis"===(e="header"===n?_xeUtils.default.isUndefined(i)||_xeUtils.default.isNull(i)?b:i:"footer"===n?_xeUtils.default.isUndefined(r)||_xeUtils.default.isNull(r)?C:r:_xeUtils.default.isUndefined(t)||_xeUtils.default.isNull(t)?w:t),s="title"===e||(!0===e||"tooltip"===e)||i,r=D["".concat(a,"-").concat(n,"-list")],"header"===n||"footer"===n?S&&!s&&(s=!0):(S||O)&&(s=s||!0),r)&&_xeUtils.default.arrayEach(r.querySelectorAll(".".concat(o.id)),function(e){var t=parseInt(e.getAttribute("colspan")||1),e=e.querySelector(".vxe-cell"),r=o.renderWidth;if(e){if(1<t)for(var i=c.getColumnIndex(o),n=1;n<t;n++){var l=c.getColumns(i+n);l&&(r+=l.renderWidth)}e.style.width=s?"".concat(r-k*t,"px"):""}})})})}),r&&this.setCurrentRow(r),i&&i.selected&&e.selected.row&&e.selected.column&&this.addColSdCls(),this.$nextTick()},checkScrolling:function(){var e=this.$refs,t=e.tableBody,r=e.leftContainer,e=e.rightContainer,t=t?t.$el:null;t&&(r&&_dom.default[0<t.scrollLeft?"addClass":"removeClass"](r,"scrolling--middle"),e)&&_dom.default[t.clientWidth<t.scrollWidth-Math.ceil(t.scrollLeft)?"addClass":"removeClass"](e,"scrolling--middle")},preventEvent:function(t,e,r,i,n){var l,o=this;return _vXETable.default.interceptor.get(e).some(function(e){return!1===e(Object.assign({$grid:o.$xegrid,$table:o,$event:t},r))})||i&&(l=i()),n&&n(),l},handleGlobalMousedownEvent:function(r){var i=this,n=this.$el,e=this.$refs,t=this.$xegrid,l=this.$toolbar,o=this.mouseConfig,s=this.editStore,a=this.ctxMenuStore,u=this.editOpts,c=this.filterStore,h=this.getRowNode,d=s.actived,s=e.ctxWrapper,f=e.filterWrapper,e=e.validTip;!f||getEventTargetNode(r,n,"vxe-cell--filter").flag||getEventTargetNode(r,f.$el).flag||getEventTargetNode(r,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(r,"event.clearFilter",c.args,this.closeFilter),d.row?!1===u.autoClear||(f=d.args.cell)&&getEventTargetNode(r,f).flag||e&&getEventTargetNode(r,e.$el).flag||this.lastCallTime&&!(this.lastCallTime+50<Date.now())||getEventTargetNode(r,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(r,"event.clearActived",d.args,function(){var e,t;(e=(e=(e="row"===u.mode?!!(e=getEventTargetNode(r,n,"vxe-body--row")).flag&&h(e.targetElem).item!==d.args.row:!getEventTargetNode(r,n,"col--edit").flag)||getEventTargetNode(r,n,"vxe-header--row").flag)||getEventTargetNode(r,n,"vxe-footer--row").flag)||!i.height||i.overflowY||(t=r.target,hasClass(t,"vxe-table--body-wrapper")&&(e=r.offsetY<t.clientHeight)),!e&&getEventTargetNode(r,n).flag||setTimeout(function(){return i.clearEdit(r)})}):!o||getEventTargetNode(r,n).flag||t&&getEventTargetNode(r,t.$el).flag||s&&getEventTargetNode(r,s.$el).flag||l&&getEventTargetNode(r,l.$el).flag||(this.clearSelected(),getEventTargetNode(r,document.body,"vxe-table--ignore-areas-clear").flag)||this.preventEvent(r,"event.clearAreas",{},function(){i.clearCellAreas(),i.clearCopyCellArea()}),a.visible&&s&&!getEventTargetNode(r,s.$el).flag&&this.closeMenu(),this.isActivated=getEventTargetNode(r,(t||this).$el).flag},handleGlobalBlurEvent:function(){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(){this.closeTooltip(),this.closeMenu()},keydownEvent:function(t){var r=this,i=this.filterStore,n=this.ctxMenuStore,e=this.editStore,l=this.keyboardConfig,o=this.mouseConfig,s=this.mouseOpts,a=this.keyboardOpts,u=e.actived;27===t.keyCode&&this.preventEvent(t,"event.keydown",null,function(){var e;r.emitEvent("keydown-start",{},t),l&&o&&s.area&&r.handleKeyboardEvent?r.handleKeyboardEvent(t):(u.row||i.visible||n.visible)&&(t.stopPropagation(),r.closeFilter(),r.closeMenu(),l)&&a.isEsc&&u.row&&(e=u.args,r.clearEdit(t),o)&&s.selected&&r.$nextTick(function(){return r.handleSelected(e,t)}),r.emitEvent("keydown",{},t),r.emitEvent("keydown-end",{},t)})},handleGlobalKeydownEvent:function(V){var q=this;this.isActivated&&this.preventEvent(V,"event.keydown",null,function(){var e,t,r,i=q.filterStore,n=q.isCtxMenu,l=q.ctxMenuStore,o=q.editStore,s=q.editOpts,a=q.editConfig,u=q.mouseConfig,c=q.mouseOpts,h=q.keyboardConfig,d=q.keyboardOpts,f=q.treeConfig,g=q.treeOpts,p=q.highlightCurrentRow,x=q.currentRow,v=q.bodyCtxMenu,m=q.rowOpts,w=o.selected,o=o.actived,b=V.keyCode,C=8===b,_=9===b,R=13===b,E=27===b,y=32===b,T=37===b,S=38===b,O=39===b,k=40===b,I=46===b,D=113===b,A=93===b,F=V.metaKey,U=V.ctrlKey,L=V.shiftKey,N=V.altKey,$=T||S||O||k,n=n&&l.visible&&(R||y||$),M=(0,_utils.isEnableConf)(a)&&o.column&&o.row;i.visible?E&&q.closeFilter():(n?(V.preventDefault(),l.showChild&&hasChildrenList(l.selected)?q.moveCtxMenu(V,b,l,"selectChild",37,!1,l.selected.children):q.moveCtxMenu(V,b,l,"selected",39,!0,q.ctxMenuList)):h&&u&&c.area&&q.handleKeyboardEvent?q.handleKeyboardEvent(V):h&&y&&d.isChecked&&w.row&&w.column&&("checkbox"===w.column.type||"radio"===w.column.type)?(V.preventDefault(),"checkbox"===w.column.type?q.handleToggleCheckRowEvent(V,w.args):q.triggerRadioRowEvent(V,w.args)):D&&(0,_utils.isEnableConf)(a)?M||w.row&&w.column&&(V.stopPropagation(),V.preventDefault(),q.handleActived(w.args,V)):A?(q._keyCtx=w.row&&w.column&&v.length,clearTimeout(q.keyCtxTimeout),q.keyCtxTimeout=setTimeout(function(){q._keyCtx=!1},1e3)):R&&!N&&h&&d.isEnter&&(w.row||o.row||f&&(m.isCurrent||p)&&x)?U?o.row&&(t=o.args,q.clearEdit(V),u)&&c.selected&&q.$nextTick(function(){return q.handleSelected(t,V)}):w.row||o.row?(i=(w.row?w:o).args,L?d.enterToTab?q.moveTabSelected(i,L,V):q.moveSelected(i,T,!0,O,!1,V):d.enterToTab?q.moveTabSelected(i,L,V):q.moveSelected(i,T,!1,O,!0,V)):f&&(m.isCurrent||p)&&x&&(E=x[g.children])&&E.length&&(V.preventDefault(),e=E[0],t={$table:q,row:e},q.setTreeExpand(x,!0).then(function(){return q.scrollToRow(e)}).then(function(){return q.triggerCurrentRowEvent(V,t)})):$&&h&&d.isArrow?M||(w.row&&w.column?q.moveSelected(w.args,T,S,O,k,V):(S||k)&&(m.isCurrent||p)&&q.moveCurrentRow(S,k,V)):_&&h&&d.isTab?w.row||w.column?q.moveTabSelected(w.args,L,V):(o.row||o.column)&&q.moveTabSelected(o.args,L,V):h&&(I||(f&&(m.isCurrent||p)&&x?C&&d.isArrow:C))?M||(n=d.delMethod,l=d.backMethod,d.isDel&&(w.row||w.column)?(n?n({row:w.row,rowIndex:q.getRowIndex(w.row),column:w.column,columnIndex:q.getColumnIndex(w.column),$table:q}):setCellValue(w.row,w.column,null),C?l?l({row:w.row,rowIndex:q.getRowIndex(w.row),column:w.column,columnIndex:q.getColumnIndex(w.column),$table:q}):q.handleActived(w.args,V):I&&q.updateFooter()):C&&d.isArrow&&f&&(m.isCurrent||p)&&x&&(r=_xeUtils.default.findTree(q.afterFullData,function(e){return e===x},g).parent)&&(V.preventDefault(),t={$table:q,row:r},q.setTreeExpand(r,!1).then(function(){return q.scrollToRow(r)}).then(function(){return q.triggerCurrentRowEvent(V,t)}))):h&&d.isEdit&&!U&&!F&&(y||48<=b&&b<=57||65<=b&&b<=90||96<=b&&b<=111||186<=b&&b<=192||219<=b&&b<=222)&&(D=d.editMethod,w.column)&&w.row&&(0,_utils.isEnableConf)(w.column.editRender)&&((a=s.beforeEditMethod||s.activeMethod)&&!a(_objectSpread(_objectSpread({},w.args),{},{$table:q}))||(D?D({row:w.row,rowIndex:q.getRowIndex(w.row),column:w.column,columnIndex:q.getColumnIndex(w.column),$table:q}):(setCellValue(w.row,w.column,null),q.handleActived(w.args,V)))),q.emitEvent("keydown",{},V))})},handleGlobalPasteEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,i=this.keyboardOpts,n=this.mouseConfig,l=this.mouseOpts,o=this.editStore,s=this.filterStore,o=o.actived;t&&!s.visible&&(o.row||o.column||r&&i.isClip&&n&&l.area&&this.handlePasteCellAreaEvent&&this.handlePasteCellAreaEvent(e),this.emitEvent("paste",{},e))},handleGlobalCopyEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,i=this.keyboardOpts,n=this.mouseConfig,l=this.mouseOpts,o=this.editStore,s=this.filterStore,o=o.actived;t&&!s.visible&&(o.row||o.column||r&&i.isClip&&n&&l.area&&this.handleCopyCellAreaEvent&&this.handleCopyCellAreaEvent(e),this.emitEvent("copy",{},e))},handleGlobalCutEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,i=this.keyboardOpts,n=this.mouseConfig,l=this.mouseOpts,o=this.editStore,s=this.filterStore,o=o.actived;t&&!s.visible&&(o.row||o.column||r&&i.isClip&&n&&l.area&&this.handleCutCellAreaEvent&&this.handleCutCellAreaEvent(e),this.emitEvent("cut",{},e))},handleGlobalResizeEvent:function(){this.closeMenu(),this.updateCellAreas(),this.recalculate(!0)},handleTargetEnterEvent:function(e){var t=this.$refs.tooltip;clearTimeout(this.tooltipTimeout),e?this.closeTooltip():t&&t.setActived(!0)},handleTargetLeaveEvent:function(){var e=this,t=this.tooltipOpts,r=this.$refs.tooltip;r&&r.setActived(!1),t.enterable?this.tooltipTimeout=setTimeout(function(){(r=e.$refs.tooltip)&&!r.isActived()&&e.closeTooltip()},t.leaveDelay):this.closeTooltip()},triggerHeaderHelpEvent:function(t,e){var r,i,n,e=e.column,e=e.titlePrefix||e.titleHelp;(e.content||e.message)&&(r=this.$refs,i=this.tooltipStore,n=(0,_utils.getFuncText)(e.content||e.message),this.handleTargetEnterEvent(!0),i.visible=!0,i.currOpts=_objectSpread(_objectSpread({},e),{},{content:null}),this.$nextTick(function(){var e=r.tooltip;e&&e.open(t.currentTarget,n)}))},triggerHeaderTooltipEvent:function(e,t){var r=this.tooltipStore,i=t.column,n=e.currentTarget;this.handleTargetEnterEvent(r.column!==i||r.row),r.column===i&&r.visible||this.handleTooltip(e,n,n,null,t)},triggerBodyTooltipEvent:function(e,t){var r,i,n=this.editConfig,l=this.editOpts,o=this.editStore,s=this.tooltipStore,o=o.actived,a=t.row,u=t.column,c=e.currentTarget;if(this.handleTargetEnterEvent(s.column!==u||s.row!==a),u.editRender&&(0,_utils.isEnableConf)(n)){if("row"===l.mode&&o.row===a)return;if(o.row===a&&o.column===u)return}s.column===u&&s.row===a&&s.visible||(u.treeNode?(r=c.querySelector(".vxe-tree-cell"),"html"===u.type&&(i=c.querySelector(".vxe-cell--html"))):i=c.querySelector("html"===u.type?".vxe-cell--html":".vxe-cell--label"),this.handleTooltip(e,c,r||c.children[0],i,t))},triggerFooterTooltipEvent:function(e,t){var r=t.column,i=this.tooltipStore,n=e.currentTarget;this.handleTargetEnterEvent(!0),i.column===r&&i.visible||this.handleTooltip(e,n,n.querySelector(".vxe-cell--item")||n.children[0],null,t)},handleTooltip:function(e,t,r,i,n){n.cell=t;var l=this.$refs,t=this.tooltipOpts,o=this.tooltipStore,s=n.column,a=n.row,u=t.showAll,c=t.enabled,t=t.contentMethod,n=t?t(n):null,t=t&&!_xeUtils.default.eqNull(n),h=t?n:("html"===s.type?r.innerText:r.textContent).trim(),d=r.scrollWidth>r.clientWidth;return h&&(u||c||t||d)&&(Object.assign(o,{row:a,column:s,visible:!0,currOpts:null}),this.$nextTick(function(){var e=l.tooltip;e&&e.open(!d&&i||r,_utils.default.formatText(h))})),this.$nextTick()},openTooltip:function(e,t){var r=this.$refs.commTip;return r?r.open(e,t):this.$nextTick()},closeTooltip:function(){var e=this.$refs,t=this.tooltipStore,r=e.tooltip,e=e.commTip;return t.visible&&(Object.assign(t,{row:null,column:null,content:null,visible:!1,currOpts:null}),r)&&r.close(),e&&e.close(),this.$nextTick()},isAllCheckboxChecked:function(){return this.isAllSelected},isAllCheckboxIndeterminate:function(){return!this.isAllSelected&&this.isIndeterminate},isCheckboxIndeterminate:function(){return(0,_log.warnLog)("vxe.error.delFunc",["isCheckboxIndeterminate","isAllCheckboxIndeterminate"]),this.isAllCheckboxIndeterminate()},getCheckboxIndeterminateRecords:function(e){var t=this,r=this.treeConfig,i=this.treeIndeterminates,n=this.fullDataRowIdData;return r?e?i.slice(0):i.filter(function(e){e=(0,_util.getRowid)(t,e);return n[e]}):[]},handleDefaultSelectionChecked:function(){var t,r=this.fullDataRowIdData,e=this.checkboxOpts,i=e.checkAll,e=e.checkRowKeys;i?this.handleCheckedAllCheckboxRow(!0,!0):e&&(t=[],e.forEach(function(e){r[e]&&t.push(r[e].row)}),this.handleCheckedCheckboxRow(t,!0,!0))},handleCheckedCheckboxRow:function(e,t,r){var i=this;return(e=e&&!_xeUtils.default.isArray(e)?[e]:e).forEach(function(e){return i.handleSelectRow({row:e},!!t,r)}),this.$nextTick()},setCheckboxRow:function(e,t){return this.handleCheckedCheckboxRow(e,t,!0)},isCheckedByCheckboxRow:function(e){var t=this.selection,r=this.checkboxOpts.checkField;return r?_xeUtils.default.get(e,r):-1<this.findRowIndexOf(t,e)},isIndeterminateByCheckboxRow:function(e){var t=this.treeIndeterminates;return-1<this.findRowIndexOf(t,e)&&!this.isCheckedByCheckboxRow(e)},handleSelectRow:function(e,r,i){var n=this,l=e.row,o=this.selection,e=this.afterFullData,t=this.treeConfig,s=this.treeOpts,a=this.treeIndeterminates,u=this.checkboxOpts,c=u.checkField,h=u.checkStrictly,d=u.checkMethod;if(c)if(t&&!h){-1===r?(-1===this.findRowIndexOf(a,l)&&a.push(l),_xeUtils.default.set(l,c,!1)):_xeUtils.default.eachTree([l],function(t){(n.eqRow(t,l)||i||!d||d({row:t}))&&(_xeUtils.default.set(t,c,r),_xeUtils.default.remove(a,function(e){return n.eqRow(e,t)}),n.handleCheckboxReserveRow(l,r))},s);var f,u=_xeUtils.default.findTree(e,function(e){return n.eqRow(e,l)},s);if(u&&u.parent)return f=!i&&d?u.items.filter(function(e){return d({row:e})}):u.items,p=_xeUtils.default.find(u.items,function(e){return-1<n.findRowIndexOf(a,e)})?-1:(p=u.items.filter(function(e){return _xeUtils.default.get(e,c)})).filter(function(e){return-1<n.findRowIndexOf(f,e)}).length===f.length||!(!p.length&&-1!==r)&&-1,this.handleSelectRow({row:u.parent},p,i)}else!i&&d&&!d({row:l})||(_xeUtils.default.set(l,c,r),this.handleCheckboxReserveRow(l,r));else if(t&&!h){-1===r?(-1===this.findRowIndexOf(a,l)&&a.push(l),_xeUtils.default.remove(o,function(e){return n.eqRow(e,l)})):_xeUtils.default.eachTree([l],function(t){(n.eqRow(t,l)||i||!d||d({row:t}))&&(r?o.push(t):_xeUtils.default.remove(o,function(e){return n.eqRow(e,t)}),_xeUtils.default.remove(a,function(e){return n.eqRow(e,t)}),n.handleCheckboxReserveRow(l,r))},s);var g,p,u=_xeUtils.default.findTree(e,function(e){return n.eqRow(e,l)},s);if(u&&u.parent)return g=!i&&d?u.items.filter(function(e){return d({row:e})}):u.items,t=_xeUtils.default.find(u.items,function(e){return-1<n.findRowIndexOf(a,e)})?-1:(p=u.items.filter(function(e){return-1<n.findRowIndexOf(o,e)})).filter(function(e){return-1<n.findRowIndexOf(g,e)}).length===g.length||!(!p.length&&-1!==r)&&-1,this.handleSelectRow({row:u.parent},t,i)}else!i&&d&&!d({row:l})||(r?-1===this.findRowIndexOf(o,l)&&o.push(l):_xeUtils.default.remove(o,function(e){return n.eqRow(e,l)}),this.handleCheckboxReserveRow(l,r));this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var r=this.selection,i=this.checkboxOpts.checkField,n=t.row,i=i?!_xeUtils.default.get(n,i):-1===this.findRowIndexOf(r,n);e?this.triggerCheckRowEvent(e,t,i):this.handleSelectRow(t,i)},triggerCheckRowEvent:function(e,t,r){var i=this.checkboxOpts.checkMethod;i&&!i({row:t.row})||(this.handleSelectRow(t,r),this.emitEvent("checkbox-change",Object.assign({records:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:r},t),e))},toggleCheckboxRow:function(e){var t=this.selection,r=this.checkboxOpts.checkField,r=r?!_xeUtils.default.get(e,r):-1===this.findRowIndexOf(t,e);return this.handleSelectRow({row:e},r,!0),this.$nextTick()},handleCheckedAllCheckboxRow:function(t,r){var i=this,n=this.afterFullData,e=this.treeConfig,l=this.treeOpts,o=this.selection,s=this.checkboxReserveRowMap,a=this.checkboxOpts,u=a.checkField,c=a.reserve,h=a.checkStrictly,d=a.checkMethod,f=[],a=e?[]:o.filter(function(e){return-1===i.findRowIndexOf(n,e)});return h?this.isAllSelected=t:(u?(h=function(e){!r&&d&&!d({row:e})||(t&&f.push(e),_xeUtils.default.set(e,u,t))},e?_xeUtils.default.eachTree(n,h,l):n.forEach(h)):e?t?_xeUtils.default.eachTree(n,function(e){!r&&d&&!d({row:e})||f.push(e)},l):!r&&d&&_xeUtils.default.eachTree(n,function(e){!d({row:e})&&-1<i.findRowIndexOf(o,e)&&f.push(e)},l):t?f=!r&&d?n.filter(function(e){return-1<i.findRowIndexOf(o,e)||d({row:e})}):n.slice(0):!r&&d&&(f=n.filter(function(e){return d({row:e})?0:-1<i.findRowIndexOf(o,e)})),c&&(t?f.forEach(function(e){s[(0,_util.getRowid)(i,e)]=e}):n.forEach(function(e){return i.handleCheckboxReserveRow(e,!1)})),this.selection=u?[]:a.concat(f)),this.treeIndeterminates=[],this.checkSelectionStatus(),this.$nextTick()},setAllCheckboxRow:function(e){return this.handleCheckedAllCheckboxRow(e,!0)},checkSelectionStatus:function(){var t,r,i=this,e=this.afterFullData,n=this.selection,l=this.treeIndeterminates,o=this.checkboxOpts,s=this.treeConfig,a=o.checkField,u=o.halfField,c=o.checkStrictly,h=o.checkMethod;c||(t=[],c=o=!(r=[]),c=a?(o=e.every(h?function(e){return h({row:e})?!!_xeUtils.default.get(e,a)&&(r.push(e),!0):(t.push(e),!0)}:function(e){return _xeUtils.default.get(e,a)})&&e.length!==t.length,s?u?!o&&e.some(function(e){return _xeUtils.default.get(e,a)||_xeUtils.default.get(e,u)||-1<i.findRowIndexOf(l,e)}):!o&&e.some(function(e){return _xeUtils.default.get(e,a)||-1<i.findRowIndexOf(l,e)}):u?!o&&e.some(function(e){return _xeUtils.default.get(e,a)||_xeUtils.default.get(e,u)}):!o&&e.some(function(e){return _xeUtils.default.get(e,a)})):(o=e.every(h?function(e){return h({row:e})?-1<i.findRowIndexOf(n,e)&&(r.push(e),!0):(t.push(e),!0)}:function(e){return-1<i.findRowIndexOf(n,e)})&&e.length!==t.length,s?!o&&e.some(function(e){return-1<i.findRowIndexOf(l,e)||-1<i.findRowIndexOf(n,e)}):!o&&e.some(function(e){return-1<i.findRowIndexOf(n,e)})),this.isAllSelected=o,this.isIndeterminate=c)},handleReserveStatus:function(){var e=this.expandColumn,t=this.treeOpts,r=this.treeConfig,i=this.fullDataRowIdData,n=this.fullAllDataRowMap,l=this.currentRow,o=this.selectRow,s=this.radioReserveRow,a=this.radioOpts,u=this.checkboxOpts,c=this.selection,h=this.rowExpandeds,d=this.treeExpandeds,f=this.expandOpts;o&&!n.has(o)&&(this.selectRow=null),a.reserve&&s&&i[o=(0,_util.getRowid)(this,s)]&&this.handleCheckedRadioRow(i[o].row,!0),this.selection=getRecoverRow(this,c),u.reserve&&this.handleCheckedCheckboxRow(handleReserveRow(this,this.checkboxReserveRowMap),!0,!0),l&&!n.has(l)&&(this.currentRow=null),this.rowExpandeds=e?getRecoverRow(this,h):[],e&&f.reserve&&this.setRowExpand(handleReserveRow(this,this.rowExpandedReserveRowMap),!0),this.treeExpandeds=r?getRecoverRow(this,d):[],r&&t.reserve&&this.setTreeExpand(handleReserveRow(this,this.treeExpandedReserveRowMap),!0)},getRadioReserveRecord:function(e){var t=this.fullDataRowIdData,r=this.radioReserveRow,i=this.radioOpts,n=this.afterFullData,l=this.treeConfig,o=this.treeOpts;if(i.reserve&&r){var s=(0,_util.getRowid)(this,r);if(e){if(!t[s])return r}else{var a=(0,_util.getRowkey)(this);if(l){if(_xeUtils.default.findTree(n,function(e){return s===_xeUtils.default.get(e,a)},o))return r}else if(!n.some(function(e){return s===_xeUtils.default.get(e,a)}))return r}}return null},clearRadioReserve:function(){return this.radioReserveRow=null,this.$nextTick()},handleRadioReserveRow:function(e){this.radioOpts.reserve&&(this.radioReserveRow=e)},getCheckboxReserveRecords:function(r){var i,t=this,n=this.fullDataRowIdData,e=this.afterFullData,l=this.checkboxReserveRowMap,o=this.checkboxOpts,s=this.treeConfig,a=this.treeOpts,u=[];return o.reserve&&(i={},s?_xeUtils.default.eachTree(e,function(e){i[(0,_util.getRowid)(t,e)]=1},a):e.forEach(function(e){i[(0,_util.getRowid)(t,e)]=1}),_xeUtils.default.each(l,function(e,t){e&&(r?n[t]||u.push(e):i[t]||u.push(e))})),u},clearCheckboxReserve:function(){return this.checkboxReserveRowMap={},this.$nextTick()},handleCheckboxReserveRow:function(e,t){var r,i=this.checkboxReserveRowMap;this.checkboxOpts.reserve&&(r=(0,_util.getRowid)(this,e),t?i[r]=e:i[r]&&delete i[r])},triggerCheckAllEvent:function(e,t){this.handleCheckedAllCheckboxRow(t),this.emitEvent("checkbox-all",{records:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:t},e)},toggleAllCheckboxRow:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearCheckboxRow:function(){var t=this,e=this.tableFullData,r=this.treeConfig,i=this.treeOpts,n=this.checkboxOpts,l=n.checkField,n=n.reserve;return l&&(r?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,l,!1)},i):e.forEach(function(e){return _xeUtils.default.set(e,l,!1)})),n&&e.forEach(function(e){return t.handleCheckboxReserveRow(e,!1)}),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleDefaultRadioChecked:function(){var e=this.radioOpts,t=this.fullDataRowIdData,r=e.checkRowKey,e=e.reserve;r&&(t[r]&&this.handleCheckedRadioRow(t[r].row,!0),e)&&(t=(0,_util.getRowkey)(this),this.radioReserveRow=_defineProperty({},t,r))},triggerRadioRowEvent:function(e,t){var r=this.selectRow,i=this.radioOpts,n=t.row,l=r!==n;l?this.handleCheckedRadioRow(n):i.strict||(l=r===n)&&(n=null,this.clearRadioRow()),l&&this.emitEvent("radio-change",_objectSpread({oldValue:r,newValue:n},t),e)},triggerCurrentRowEvent:function(e,t){var r=this.currentRow,i=t.row,n=r!==i;this.setCurrentRow(i),n&&this.emitEvent("current-change",_objectSpread({oldValue:r,newValue:i},t),e)},setCurrentRow:function(e){var t=this.$el,r=this.rowOpts;return this.clearCurrentRow(),this.currentRow=e,(r.isCurrent||this.highlightCurrentRow)&&t&&_xeUtils.default.arrayEach(t.querySelectorAll('[rowid="'.concat((0,_util.getRowid)(this,e),'"]')),function(e){return addClass(e,"row--current")}),this.$nextTick()},isCheckedByRadioRow:function(e){return this.selectRow===e},handleCheckedRadioRow:function(e,t){var r=this.radioOpts.checkMethod;return e&&(t||!r||r({row:e}))&&(this.selectRow=e,this.handleRadioReserveRow(e)),this.$nextTick()},setRadioRow:function(e){return this.handleCheckedRadioRow(e,!0)},clearCurrentRow:function(){var e=this.$el;return this.currentRow=null,this.hoverRow=null,e&&_xeUtils.default.arrayEach(e.querySelectorAll(".row--current"),function(e){return removeClass(e,"row--current")}),this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRecord:function(){return this.rowOpts.isCurrent||this.highlightCurrentRow?this.currentRow:null},getRadioRecord:function(e){var t=this.treeConfig,r=this.treeOpts,i=this.selectRow,n=this.fullDataRowIdData,l=this.afterFullData;if(i){var o=(0,_util.getRowid)(this,i);if(e){if(!n[o])return i}else if(t){var s=(0,_util.getRowkey)(this);if(_xeUtils.default.findTree(l,function(e){return o===_xeUtils.default.get(e,s)},r))return i}else if(-1<l.indexOf(i))return i}return null},triggerHoverEvent:function(e,t){t=t.row;this.setHoverRow(t)},setHoverRow:function(e){var t=this.$el,r=(0,_util.getRowid)(this,e);this.clearHoverRow(),t&&_xeUtils.default.arrayEach(t.querySelectorAll('[rowid="'.concat(r,'"]')),function(e){return addClass(e,"row--hover")}),this.hoverRow=e},clearHoverRow:function(){var e=this.$el;e&&_xeUtils.default.arrayEach(e.querySelectorAll(".vxe-body--row.row--hover"),function(e){return removeClass(e,"row--hover")}),this.hoverRow=null},triggerHeaderCellClickEvent:function(e,t){var r=this._lastResizeTime,i=this.sortOpts,n=t.column,l=e.currentTarget,r=r&&r>Date.now()-300,o=getEventTargetNode(e,l,"vxe-cell--sort").flag,s=getEventTargetNode(e,l,"vxe-cell--filter").flag;return"cell"!==i.trigger||r||o||s||this.triggerSortEvent(e,n,getNextSortOrder(this,n)),this.emitEvent("header-cell-click",Object.assign({triggerResizable:r,triggerSort:o,triggerFilter:s,cell:l},t),e),this.columnOpts.isCurrent||this.highlightCurrentColumn?this.setCurrentColumn(n):this.$nextTick()},triggerHeaderCellDblclickEvent:function(e,t){this.emitEvent("header-cell-dblclick",Object.assign({cell:e.currentTarget},t),e)},getCurrentColumn:function(){return this.columnOpts.isCurrent||this.highlightCurrentColumn?this.currentColumn:null},setCurrentColumn:function(e){e=(0,_util.handleFieldOrColumn)(this,e);return e&&(this.clearCurrentColumn(),this.currentColumn=e),this.$nextTick()},clearCurrentColumn:function(){return this.currentColumn=null,this.$nextTick()},checkValidate:function(e){return _vXETable.default._valid?this.triggerValidate(e):this.$nextTick()},handleChangeCell:function(e,t){var r=this;this.checkValidate("blur").catch(function(e){return e}).then(function(){r.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e})})},triggerCellClickEvent:function(e,t){var r=this.highlightCurrentRow,i=this.editStore,n=this.radioOpts,l=this.expandOpts,o=this.treeOpts,s=this.editConfig,a=this.editOpts,u=this.checkboxOpts,c=this.rowOpts,i=i.actived,h=t,d=h.row,h=h.column,f=h.type,g=h.treeNode,p="radio"===f,x="checkbox"===f,f="expand"===f,v=e.currentTarget,m=p&&getEventTargetNode(e,v,"vxe-cell--radio").flag,w=x&&getEventTargetNode(e,v,"vxe-cell--checkbox").flag,b=g&&getEventTargetNode(e,v,"vxe-tree--btn-wrapper").flag,C=f&&getEventTargetNode(e,v,"vxe-table--expanded").flag;t=Object.assign({cell:v,triggerRadio:m,triggerCheckbox:w,triggerTreeNode:b,triggerExpandNode:C},t),!w&&!m&&(!C&&("row"===l.trigger||f&&"cell"===l.trigger)&&this.triggerRowExpandEvent(e,t),"row"===o.trigger||g&&"cell"===o.trigger)&&this.triggerTreeExpandEvent(e,t),b||(C||(!c.isCurrent&&!r||w||m||this.triggerCurrentRowEvent(e,t),!m&&("row"===n.trigger||p&&"cell"===n.trigger)&&this.triggerRadioRowEvent(e,t),!w&&("row"===u.trigger||x&&"cell"===u.trigger)&&this.handleToggleCheckRowEvent(e,t)),(0,_utils.isEnableConf)(s)&&("manual"===a.trigger?i.args&&i.row===d&&h!==i.column&&this.handleChangeCell(e,t):i.args&&d===i.row&&h===i.column||("click"===a.trigger||"dblclick"===a.trigger&&"row"===a.mode&&i.row===d)&&this.handleChangeCell(e,t))),this.emitEvent("cell-click",t,e)},triggerCellDblclickEvent:function(e,t){var r=this,i=this.editStore,n=this.editConfig,l=this.editOpts,i=i.actived,o=e.currentTarget;t.cell=o,!(0,_utils.isEnableConf)(n)||"dblclick"!==l.trigger||i.args&&e.currentTarget===i.args.cell||("row"===l.mode?this.checkValidate("blur").catch(function(e){return e}).then(function(){r.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e})}):"cell"===l.mode&&this.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e})),this.emitEvent("cell-dblclick",t,e)},handleDefaultSort:function(){var i=this,e=this.sortConfig,t=this.sortOpts,r=t.defaultSort;r&&(r=_xeUtils.default.isArray(r)?r:[r]).length&&((e.multiple?r:r.slice(0,1)).forEach(function(e,t){var r=e.field,e=e.order;r&&e&&(r=i.getColumnByField(r))&&r.sortable&&(r.order=e,r.sortTime=Date.now()+t)}),t.remote||this.handleTableData(!0).then(this.updateStyle))},triggerSortEvent:function(e,t,r){var i=this.sortOpts,n=t.field,l=t.sortable,o=t.remoteSort;(l||o)&&(r&&t.order!==r?this.sort({field:n,order:r}):this.clearSort(i.multiple?t:null),l={column:t,field:n,property:n,order:t.order,sortList:this.getSortColumns()},this.emitEvent("sort-change",l,e))},sort:function(e,t){var n,l=this,r=this.sortOpts,i=r.multiple,o=r.remote,s=r.orders;return e&&_xeUtils.default.isString(e)&&(e=[{field:e,order:t}]),(e=_xeUtils.default.isArray(e)?e:[e]).length?(i||clearAllSort(this),(i?e:[e[0]]).forEach(function(e,t){var r=e.field,e=e.order,i=r;(i=_xeUtils.default.isString(r)?l.getColumnByField(r):i)&&(i.sortable||i.remoteSort)&&(n=n||i,-1===s.indexOf(e)&&(e=getNextSortOrder(l,i)),i.order!==e&&(i.order=e),i.sortTime=Date.now()+t)}),(!o||n&&n.remoteSort)&&this.handleTableData(!0),this.$nextTick().then(this.updateStyle)):this.$nextTick()},clearSort:function(e){var t=this.sortOpts;return e?(e=(0,_util.handleFieldOrColumn)(this,e))&&(e.order=null):clearAllSort(this),t.remote||this.handleTableData(!0),this.$nextTick().then(this.updateStyle)},getSortColumn:function(){return"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delFunc",["getSortColumn","getSortColumns"]),_xeUtils.default.find(this.tableFullColumn,function(e){return(e.sortable||e.remoteSort)&&e.order})},isSort:function(e){return e?(e=(0,_util.handleFieldOrColumn)(this,e))&&e.sortable&&!!e.order:0<this.getSortColumns().length},getSortColumns:function(){var e=this.sortOpts,t=e.multiple,e=e.chronological,i=[];return this.tableFullColumn.forEach(function(e){var t=e.field,r=e.order;(e.sortable||e.remoteSort)&&r&&i.push({column:e,field:t,property:t,order:r,sortTime:e.sortTime})}),t&&e&&1<i.length?_xeUtils.default.orderBy(i,"sortTime"):i},closeFilter:function(){var e=this.filterStore,t=e.column,r=e.visible;return Object.assign(e,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),r&&this.emitEvent("filter-visible",{column:t,field:t.field,property:t.field,filterList:this.getCheckedFilters(),visible:!1},null),this.$nextTick()},isFilter:function(e){e=(0,_util.handleFieldOrColumn)(this,e);return e?e.filters&&e.filters.some(function(e){return e.checked}):0<this.getCheckedFilters().length},isRowExpandLoaded:function(e){e=this.fullAllDataRowMap.get(e);return e&&e.expandLoaded},clearRowExpandLoaded:function(t){var r=this,e=this.expandOpts,i=this.expandLazyLoadeds,n=this.fullAllDataRowMap,e=e.lazy,n=n.get(t);return e&&n&&(n.expandLoaded=!1,_xeUtils.default.remove(i,function(e){return r.eqRow(e,t)})),this.$nextTick()},reloadRowExpand:function(e){var t=this,r=this.expandOpts,i=this.expandLazyLoadeds;return r.lazy&&-1===this.findRowIndexOf(i,e)&&this.clearRowExpandLoaded(e).then(function(){return t.handleAsyncRowExpand(e)}),this.$nextTick()},reloadExpandContent:function(e){return"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delFunc",["reloadExpandContent","reloadRowExpand"]),this.reloadRowExpand(e)},triggerRowExpandEvent:function(e,t){var r,i=this.expandOpts,n=this.expandLazyLoadeds,l=this.expandColumn,t=t.row;i.lazy&&-1!==this.findRowIndexOf(n,t)||(i=!this.isExpandByRow(t),n=this.getColumnIndex(l),r=this.getVMColumnIndex(l),this.setRowExpand(t,i),this.emitEvent("toggle-row-expand",{expanded:i,column:l,columnIndex:n,$columnIndex:r,row:t,rowIndex:this.getRowIndex(t),$rowIndex:this.getVMRowIndex(t)},e))},toggleRowExpand:function(e){return this.setRowExpand(e,!this.isExpandByRow(e))},handleDefaultRowExpand:function(){var t,e=this.expandOpts,r=this.fullDataRowIdData,i=e.expandAll,e=e.expandRowKeys;i?this.setAllRowExpand(!0):e&&(t=[],e.forEach(function(e){r[e]&&t.push(r[e].row)}),this.setRowExpand(t,!0))},setAllRowExpand:function(e){return this.setRowExpand(this.expandOpts.lazy?this.tableData:this.tableFullData,e)},handleAsyncRowExpand:function(t){var r=this,i=this.fullAllDataRowMap.get(t);return new Promise(function(e){r.expandLazyLoadeds.push(t),r.expandOpts.loadMethod({$table:r,row:t,rowIndex:r.getRowIndex(t),$rowIndex:r.getVMRowIndex(t)}).then(function(){i.expandLoaded=!0,r.rowExpandeds.push(t)}).catch(function(){i.expandLoaded=!1}).finally(function(){_xeUtils.default.remove(r.expandLazyLoadeds,function(e){return r.eqRow(e,t)}),e(r.$nextTick().then(r.recalculate))})})},setRowExpand:function(e,t){var r,i=this,n=this.fullAllDataRowMap,l=this.expandLazyLoadeds,o=this.expandOpts,s=this.expandColumn,a=this.rowExpandeds,u=o.reserve,c=o.lazy,h=o.accordion,d=o.toggleMethod,f=[],g=this.getColumnIndex(s),p=this.getVMColumnIndex(s);return e&&(_xeUtils.default.isArray(e)||(e=[e]),h&&(a=[],e=e.slice(e.length-1,e.length)),r=d?e.filter(function(e){return d({expanded:t,column:s,columnIndex:g,$columnIndex:p,row:e,rowIndex:i.getRowIndex(e),$rowIndex:i.getVMRowIndex(e)})}):e,t?r.forEach(function(e){var t;-1===i.findRowIndexOf(a,e)&&(t=n.get(e),c&&!t.expandLoaded&&-1===i.findRowIndexOf(l,e)?f.push(i.handleAsyncRowExpand(e)):a.push(e))}):_xeUtils.default.remove(a,function(e){return-1<i.findRowIndexOf(r,e)}),u)&&r.forEach(function(e){return i.handleRowExpandReserve(e,t)}),this.rowExpandeds=a,Promise.all(f).then(this.recalculate)},isExpandByRow:function(e){var t=this.rowExpandeds;return-1<this.findRowIndexOf(t,e)},clearRowExpand:function(){var t=this,e=this.expandOpts,r=this.rowExpandeds,i=this.tableFullData,e=e.reserve,n=r.length;return this.rowExpandeds=[],e&&i.forEach(function(e){return t.handleRowExpandReserve(e,!1)}),this.$nextTick().then(function(){n&&t.recalculate()})},clearRowExpandReserve:function(){return this.rowExpandedReserveRowMap={},this.$nextTick()},handleRowExpandReserve:function(e,t){var r,i=this.rowExpandedReserveRowMap;this.expandOpts.reserve&&(r=(0,_util.getRowid)(this,e),t?i[r]=e:i[r]&&delete i[r])},getRowExpandRecords:function(){return this.rowExpandeds.slice(0)},getTreeExpandRecords:function(){return this.treeExpandeds.slice(0)},getTreeStatus:function(){return this.treeConfig?{config:this.treeOpts,rowExpandeds:this.getTreeExpandRecords()}:null},isTreeExpandLoaded:function(e){e=this.fullAllDataRowMap.get(e);return e&&e.treeLoaded},clearTreeExpandLoaded:function(t){var e=this.treeOpts,r=this.treeExpandeds,i=this.fullAllDataRowMap,n=e.transform,e=e.lazy,i=i.get(t);return e&&i&&(i.treeLoaded=!1,_xeUtils.default.remove(r,function(e){return t===e})),n?(this.handleVirtualTreeToList(),this.handleTableData()):this.$nextTick()},reloadTreeExpand:function(e){var t=this,r=this.treeOpts,i=this.treeLazyLoadeds,n=r.transform,l=r.lazy,r=r.hasChild;return l&&e[r]&&-1===i.indexOf(e)&&this.clearTreeExpandLoaded(e).then(function(){return t.handleAsyncTreeExpandChilds(e)}).then(function(){if(n)return t.handleVirtualTreeToList(),t.handleTableData()}).then(function(){return t.recalculate()}),this.$nextTick()},reloadTreeChilds:function(e){return"development"===process.env.NODE_ENV&&(0,_log.warnLog)("vxe.error.delFunc",["reloadTreeChilds","reloadTreeExpand"]),this.reloadTreeExpand(e)},triggerTreeExpandEvent:function(e,t){var r,i=this.treeOpts,n=this.treeLazyLoadeds,l=t.row,t=t.column;i.lazy&&-1!==n.indexOf(l)||(i=!this.isTreeExpandByRow(l),n=this.getColumnIndex(t),r=this.getVMColumnIndex(t),this.setTreeExpand(l,i),this.emitEvent("toggle-tree-expand",{expanded:i,column:t,columnIndex:n,$columnIndex:r,row:l},e))},toggleTreeExpand:function(e){return this.setTreeExpand(e,!this.isTreeExpandByRow(e))},handleDefaultTreeExpand:function(){var e,r,i,t=this.treeConfig,n=this.treeOpts,l=this.tableFullData;t&&(t=n.expandAll,e=n.expandRowKeys,t?this.setAllTreeExpand(!0):e&&(r=[],i=(0,_util.getRowkey)(this),e.forEach(function(t){var e=_xeUtils.default.findTree(l,function(e){return t===_xeUtils.default.get(e,i)},n);e&&r.push(e.item)}),this.setTreeExpand(r,!0)))},handleAsyncTreeExpandChilds:function(t){var r=this,e=this.fullAllDataRowMap,i=this.treeExpandeds,n=this.treeOpts,l=this.treeLazyLoadeds,o=this.checkboxOpts,s=n.transform,a=n.loadMethod,u=o.checkStrictly,c=e.get(t);return new Promise(function(e){l.push(t),a({$table:r,row:t}).then(function(e){if(c.treeLoaded=!0,_xeUtils.default.remove(l,function(e){return e===t}),e=_xeUtils.default.isArray(e)?e:[])return r.loadTreeChildren(t,e).then(function(e){return e.length&&-1===i.indexOf(t)&&i.push(t),!u&&r.isCheckedByCheckboxRow(t)&&r.handleCheckedCheckboxRow(e,!0,!0),r.$nextTick().then(function(){if(s)return r.handleTableData()})})}).catch(function(){c.treeLoaded=!1,_xeUtils.default.remove(l,function(e){return e===t})}).finally(function(){r.$nextTick().then(function(){return r.recalculate()}).then(function(){return e()})})})},setAllTreeExpand:function(e){var t=this.tableFullData,r=this.treeOpts,i=r.lazy,n=r.children,l=[];return _xeUtils.default.eachTree(t,function(e){var t=e[n];(i||t&&t.length)&&l.push(e)},r),this.setTreeExpand(l,e)},handleBaseTreeExpand:function(e,t){var r,i=this,n=this.fullAllDataRowMap,l=this.tableFullData,o=this.treeExpandeds,s=this.treeOpts,a=this.treeLazyLoadeds,u=this.treeNodeColumn,c=s.reserve,h=s.lazy,d=s.hasChild,f=s.children,g=s.accordion,p=s.toggleMethod,x=[],v=this.getColumnIndex(u),m=this.getVMColumnIndex(u),w=p?e.filter(function(e){return p({expanded:t,column:u,columnIndex:v,$columnIndex:m,row:e})}):e;return g&&(w=w.length?[w[w.length-1]]:[],r=_xeUtils.default.findTree(l,function(e){return e===w[0]},s))&&_xeUtils.default.remove(o,function(e){return-1<r.items.indexOf(e)}),t?w.forEach(function(e){var t;-1===o.indexOf(e)&&(t=n.get(e),h&&e[d]&&!t.treeLoaded&&-1===a.indexOf(e)?x.push(i.handleAsyncTreeExpandChilds(e)):e[f]&&e[f].length&&o.push(e))}):_xeUtils.default.remove(o,function(e){return-1<w.indexOf(e)}),c&&w.forEach(function(e){return i.handleTreeExpandReserve(e,t)}),Promise.all(x).then(this.recalculate)},handleVirtualTreeExpand:function(e,t){var r=this;return this.handleBaseTreeExpand(e,t).then(function(){return r.handleVirtualTreeToList(),r.handleTableData()}).then(function(){return r.recalculate()})},setTreeExpand:function(e,t){var r=this.treeOpts.transform;return e&&(e=_xeUtils.default.isArray(e)?e:[e]).length?r?this.handleVirtualTreeExpand(e,t):this.handleBaseTreeExpand(e,t):this.$nextTick()},isTreeExpandByRow:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){var t=this,e=this.treeOpts,r=this.treeExpandeds,i=this.tableFullData,n=e.transform,l=e.reserve,o=r.length;return this.treeExpandeds=[],l&&_xeUtils.default.eachTree(i,function(e){return t.handleTreeExpandReserve(e,!1)},e),this.handleTableData().then(function(){if(n)return t.handleVirtualTreeToList(),t.handleTableData()}).then(function(){o&&t.recalculate()})},clearTreeExpandReserve:function(){return this.treeExpandedReserveRowMap={},this.$nextTick()},handleTreeExpandReserve:function(e,t){var r,i=this.treeExpandedReserveRowMap;this.treeOpts.reserve&&(r=(0,_util.getRowid)(this,e),t?i[r]=e:i[r]&&delete i[r])},getScroll:function(){var e=this.$refs,t=this.scrollXLoad,r=this.scrollYLoad,e=e.tableBody.$el;return{virtualX:t,virtualY:r,scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}},triggerScrollXEvent:function(){this.loadScrollXData()},loadScrollXData:function(){var e=this.mergeList,t=this.mergeFooterList,r=this.scrollXStore,i=r.startIndex,n=r.endIndex,l=r.offsetSize,o=computeVirtualX(this),s=o.toVisibleIndex,o=o.visibleSize,l={startIndex:Math.max(0,s-1-l),endIndex:s+o+l},e=(calculateMergerOffserIndex(e.concat(t),l,"col"),l.startIndex),t=l.endIndex;!(s<=i||n-o-1<=s)||i===e&&n===t||(r.startIndex=e,r.endIndex=t,this.updateScrollXData()),this.closeTooltip()},triggerScrollYEvent:function(e){var t=this.scrollYStore,r=t.adaptive,i=t.offsetSize,t=t.visibleSize;isWebkit&&r&&2*i+t<=40?this.loadScrollYData(e):this.debounceScrollY(e)},debounceScrollY:_xeUtils.default.debounce(function(e){this.loadScrollYData(e)},debounceScrollYDuration,{leading:!1,trailing:!0}),loadScrollYData:function(e){var t=this.mergeList,r=this.scrollYStore,i=r.startIndex,n=r.endIndex,l=r.visibleSize,o=r.offsetSize,s=r.rowHeight,e=(e.currentTarget||e.target).scrollTop,e=Math.floor(e/s),s={startIndex:Math.max(0,e-1-o),endIndex:e+l+o},o=(calculateMergerOffserIndex(t,s,"row"),s.startIndex),t=s.endIndex;!(e<=i||n-l-1<=e)||i===o&&n===t||(r.startIndex=o,r.endIndex=t,this.updateScrollYData())},computeScrollLoad:function(){var o=this;return this.$nextTick().then(function(){var e=o.sYOpts,t=o.sXOpts,r=o.scrollXLoad,i=o.scrollYLoad,n=o.scrollXStore,l=o.scrollYStore,r=(r?(r=computeVirtualX(o).visibleSize,t=t.oSize?_xeUtils.default.toNumber(t.oSize):_dom.browse.msie?10:_dom.browse.edge?5:0,n.offsetSize=t,n.visibleSize=r,n.endIndex=Math.max(n.startIndex+n.visibleSize+t,n.endIndex),o.updateScrollXData()):o.updateScrollXSpace(),computeVirtualY(o)),t=r.rowHeight,n=r.visibleSize;l.rowHeight=t,i?(r=e.oSize?_xeUtils.default.toNumber(e.oSize):_dom.browse.msie?20:_dom.browse.edge?10:0,l.offsetSize=r,l.visibleSize=n,l.endIndex=Math.max(l.startIndex+n+r,l.endIndex),o.updateScrollYData()):o.updateScrollYSpace(),o.rowHeight=t,o.$nextTick(o.updateStyle)})},handleTableColumn:function(){var e=this.scrollXLoad,t=this.visibleColumn,r=this.scrollXStore;this.tableColumn=e?t.slice(r.startIndex,r.endIndex):t.slice(0)},updateScrollXData:function(){var e=this;this.$nextTick(function(){e.handleTableColumn(),e.updateScrollXSpace()})},updateScrollXSpace:function(){var e=this.$refs,t=this.isGroup,i=this.elemStore,r=this.visibleColumn,n=this.scrollXStore,l=this.scrollXLoad,o=this.tableWidth,s=this.scrollbarWidth,a=e.tableHeader,u=e.tableBody,e=e.tableFooter,u=u?u.$el:null;u&&(a=a?a.$el:null,e=e?e.$el:null,a=a?a.querySelector(".vxe-table--header"):null,u=u.querySelector(".vxe-table--body"),e=e?e.querySelector(".vxe-table--footer"):null,r=r.slice(0,n.startIndex).reduce(function(e,t){return e+t.renderWidth},0),n="",l&&(n="".concat(r,"px")),a&&(a.style.marginLeft=t?"":n),u.style.marginLeft=n,e&&(e.style.marginLeft=n),["main"].forEach(function(r){["header","body","footer"].forEach(function(e){var t=i["".concat(r,"-").concat(e,"-xSpace")];t&&(t.style.width=l?"".concat(o+("header"===e?s:0),"px"):"")})}),this.$nextTick(this.updateStyle))},updateScrollYData:function(){var e=this;this.$nextTick(function(){e.handleTableData(),e.updateScrollYSpace()})},updateScrollYSpace:function(){var r=this.elemStore,e=this.scrollYStore,t=this.scrollYLoad,i=this.afterFullData,n=e.startIndex,e=e.rowHeight,i=i.length*e,n=Math.max(0,n*e),l="",o="";t&&(l="".concat(n,"px"),o="".concat(i,"px")),["main","left","right"].forEach(function(t){var e=r["".concat(t,"-body-table")];e&&(e.style.marginTop=l),["header","body","footer"].forEach(function(e){e=r["".concat(t,"-").concat(e,"-ySpace")];e&&(e.style.height=o)})}),this.$nextTick(this.updateStyle)},scrollTo:function(e,t){var r=this,i=this.$refs,n=i.tableBody,l=i.rightBody,i=i.tableFooter,n=n?n.$el:null,l=l?l.$el:null,i=i?i.$el:null;return _xeUtils.default.isNumber(e)&&(0,_dom.setScrollLeft)(i||n,e),_xeUtils.default.isNumber(t)&&(0,_dom.setScrollTop)(l||n,t),this.scrollXLoad||this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(r.$nextTick())},50)}):this.$nextTick()},scrollToRow:function(e,t){var r=[];return e&&(this.treeConfig?r.push(this.scrollToTreeRow(e)):r.push((0,_util.rowToVisible)(this,e))),t&&r.push(this.scrollToColumn(t)),Promise.all(r)},scrollToColumn:function(e){e=(0,_util.handleFieldOrColumn)(this,e);return e&&this.fullColumnMap.has(e)?(0,_util.colToVisible)(this,e):this.$nextTick()},scrollToTreeRow:function(t){var r,i=this,e=this.tableFullData,n=this.treeConfig,l=this.treeOpts,o=[];return n&&(n=_xeUtils.default.findTree(e,function(e){return e===t},l))&&(r=n.nodes).forEach(function(e,t){t<r.length-1&&!i.isTreeExpandByRow(e)&&o.push(i.setTreeExpand(e,!0))}),Promise.all(o).then(function(){return(0,_util.rowToVisible)(i,t)})},clearScroll:function(){var e=this.$refs,t=this.scrollXStore,r=this.scrollYStore,i=e.tableBody,n=e.rightBody,e=e.tableFooter,i=i?i.$el:null,n=n?n.$el:null,e=e?e.$el:null;return n&&((0,_util.restoreScrollListener)(n),n.scrollTop=0),e&&(e.scrollLeft=0),i&&((0,_util.restoreScrollListener)(i),i.scrollTop=0,i.scrollLeft=0),t.startIndex=0,r.startIndex=0,this.$nextTick()},updateFooter:function(){var e=this.showFooter,t=this.visibleColumn,r=this.footerMethod;return e&&r&&(this.footerTableData=t.length?r({columns:t,data:this.afterFullData,$table:this,$grid:this.$xegrid}):[]),this.$nextTick()},updateStatus:function(o,s){var a=this,u=!_xeUtils.default.isUndefined(s);return this.$nextTick().then(function(){var e=a.$refs,t=a.editRules,r=a.validStore;if(o&&e.tableBody&&t){var i=o.row,n=o.column;if(a.hasCellRules("change",i,n)){var l=a.getCell(i,n);if(l)return a.validCellRules("change",i,n,s).then(function(){u&&r.visible&&setCellValue(i,n,s),a.clearValidate()}).catch(function(e){e=e.rule;u&&setCellValue(i,n,s),a.showValidTooltip({rule:e,row:i,column:n,cell:l})})}}})},handleDefaultMergeCells:function(){this.setMergeCells(this.mergeCells)},setMergeCells:function(e){var t=this;return this.spanMethod&&(0,_log.errLog)("vxe.error.errConflicts",["merge-cells","span-method"]),setMerges(this,e,this.mergeList,this.afterFullData),this.$nextTick().then(function(){return t.updateCellAreas()})},removeMergeCells:function(e){var t=this,r=(this.spanMethod&&(0,_log.errLog)("vxe.error.errConflicts",["merge-cells","span-method"]),removeMerges(this,e,this.mergeList,this.afterFullData));return this.$nextTick().then(function(){return t.updateCellAreas(),r})},getMergeCells:function(){return this.mergeList.slice(0)},clearMergeCells:function(){return this.mergeList=[],this.$nextTick()},handleDefaultMergeFooterItems:function(){this.setMergeFooterItems(this.mergeFooterItems)},setMergeFooterItems:function(e){var t=this;return this.footerSpanMethod&&(0,_log.errLog)("vxe.error.errConflicts",["merge-footer-items","footer-span-method"]),setMerges(this,e,this.mergeFooterList,null),this.$nextTick().then(function(){return t.updateCellAreas()})},removeMergeFooterItems:function(e){var t=this,r=(this.footerSpanMethod&&(0,_log.errLog)("vxe.error.errConflicts",["merge-footer-items","footer-span-method"]),removeMerges(this,e,this.mergeFooterList,null));return this.$nextTick().then(function(){return t.updateCellAreas(),r})},getMergeFooterItems:function(){return this.mergeFooterList.slice(0)},clearMergeFooterItems:function(){return this.mergeFooterList=[],this.$nextTick()},updateZindex:function(){this.zIndex?this.tZindex=this.zIndex:this.tZindex<_utils.default.getLastZIndex()&&(this.tZindex=_utils.default.nextZIndex())},updateCellAreas:function(){return this.mouseConfig&&this.mouseOpts.area&&this.handleUpdateCellAreas?this.handleUpdateCellAreas():this.$nextTick()},emitEvent:function(e,t,r){this.$emit(e,Object.assign({$table:this,$grid:this.$xegrid,$event:r},t))},focus:function(){return this.isActivated=!0,this.$nextTick()},blur:function(){return this.isActivated=!1,this.$nextTick()},connect:function(e){return e&&e.syncUpdate?(e.syncUpdate({collectColumn:this.collectColumn,$table:this}),this.$toolbar=e):(0,_log.errLog)("vxe.error.barUnableLink"),this.$nextTick()},getCell:function(e,t){var r=this.$refs,e=(0,_util.getRowid)(this,e),r=r["".concat(t.fixed||"table","Body")]||r.tableBody;return r&&r.$el?r.$el.querySelector('.vxe-body--row[rowid="'.concat(e,'"] .').concat(t.id)):null},getCellLabel:function(e,t){var r=t.formatter,i=_utils.default.getCellValue(e,t),n=i;if(r){var l,o=this.fullAllDataRowMap,s=t.id,a=o.has(e);if(a&&(l=(l=(a=o.get(e)).formatData)||(o.get(e).formatData={}),a)&&l[s]&&l[s].value===i)return l[s].label;o={cellValue:i,row:e,rowIndex:this.getRowIndex(e),column:t,columnIndex:this.getColumnIndex(t)};n=_xeUtils.default.isString(r)?(a=_formats.formats.get(r))?a(o):"":_xeUtils.default.isArray(r)?(e=_formats.formats.get(r[0]))?e.apply(void 0,[o].concat(_toConsumableArray(r.slice(1)))):"":r(o),l&&(l[s]={value:i,label:n})}return n},findRowIndexOf:function(e,t){var r=this;return t?_xeUtils.default.findIndexOf(e,function(e){return r.eqRow(e,t)}):-1},eqRow:function(e,t){return!(!e||!t||e!==t&&(0,_util.getRowid)(this,e)!==(0,_util.getRowid)(this,t))},getSetupOptions:function(){return _conf.default}},funcs="setFilter,openFilter,clearFilter,getCheckedFilters,closeMenu,setActiveCellArea,getActiveCellArea,getCellAreas,clearCellAreas,copyCellArea,cutCellArea,pasteCellArea,getCopyCellArea,getCopyCellAreas,clearCopyCellArea,setCellAreas,openFind,openReplace,closeFNR,getSelectedCell,clearSelected,insert,insertAt,remove,removeCheckboxRow,removeRadioRow,removeCurrentRow,getRecordset,getInsertRecords,getRemoveRecords,getUpdateRecords,clearEdit,clearActived,getEditRecord,getActiveRecord,isEditByRow,isActiveByRow,setEditRow,setActiveRow,setEditCell,setActiveCell,setSelectCell,clearValidate,fullValidate,validate,openExport,openPrint,exportData,openImport,importData,saveFile,readFile,importByFile,print".split(","),_default=(funcs.forEach(function(e){Methods[e]=function(){return"development"!==process.env.NODE_ENV||this["_".concat(e)]||("openExport,openPrint,exportData,openImport,importData,saveFile,readFile,importByFile,print".split(",").includes(e)?(0,_log.errLog)("vxe.error.reqModule",["Export"]):"clearValidate,fullValidate,validate".split(",").includes(e)&&(0,_log.errLog)("vxe.error.reqModule",["Validator"])),this["_".concat(e)]?this["_".concat(e)].apply(this,arguments):null}}),Methods);exports.default=_default;